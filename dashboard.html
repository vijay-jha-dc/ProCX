<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ProCX - Revolutionary AI Customer Experience Platform</title>
    
    <!-- Modern Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&family=JetBrains+Mono:wght@400;500;600&display=swap" rel="stylesheet">
    
    <!-- Premium Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Alpine.js -->
    <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>
    
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.js"></script>
    
    <!-- Socket.IO -->
    <script src="https://cdn.socket.io/4.5.4/socket.io.min.js"></script>
    
    <style>
        [x-cloak] { display: none !important; }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            /* Revolutionary Color Palette - Professional & Eye-catching */
            --primary: #6366f1;
            --primary-dark: #4f46e5;
            --primary-light: #818cf8;
            --secondary: #8b5cf6;
            --accent: #06b6d4;
            --success: #10b981;
            --warning: #f59e0b;
            --danger: #ef4444;
            --info: #3b82f6;
            
            /* Premium Backgrounds - Modern Glass Design */
            --bg-primary: #0f0f23;
            --bg-secondary: #1a1a2e;
            --bg-tertiary: #16213e;
            --bg-card: rgba(26, 26, 46, 0.8);
            --bg-hover: rgba(22, 33, 62, 0.9);
            
            /* Advanced Glass Effects */
            --glass-bg: rgba(26, 26, 46, 0.75);
            --glass-border: rgba(99, 102, 241, 0.2);
            --glass-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5);
            
            /* Premium Text Colors */
            --text-primary: #f8fafc;
            --text-secondary: #e2e8f0;
            --text-muted: #94a3b8;
            --text-accent: #60a5fa;
            
            /* Advanced Shadows & Effects */
            --shadow-glow: 0 0 30px rgba(99, 102, 241, 0.3);
            --shadow-card: 0 10px 30px rgba(0, 0, 0, 0.3);
            --shadow-hover: 0 20px 40px rgba(0, 0, 0, 0.4);
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background: linear-gradient(135deg, #0f0f23 0%, #1a1a2e 25%, #16213e 50%, #1a1a2e 75%, #0f0f23 100%);
            color: var(--text-primary);
            min-height: 100vh;
            overflow-x: hidden;
            position: relative;
        }

        /* Subtle Static Background */
        .bg-revolutionary {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
            background: 
                radial-gradient(circle at 20% 50%, rgba(99, 102, 241, 0.08) 0%, transparent 50%),
                radial-gradient(circle at 80% 20%, rgba(139, 92, 246, 0.08) 0%, transparent 50%),
                radial-gradient(circle at 40% 80%, rgba(6, 182, 212, 0.08) 0%, transparent 50%),
                linear-gradient(135deg, #0f0f23 0%, #1a1a2e 50%, #0f0f23 100%);
        }

        /* Floating Particles - Disabled */
        .particles {
            display: none;
        }

        @keyframes particleFloat {
            0% { transform: translateY(100vh) rotate(0deg); opacity: 0; }
            10% { opacity: 0.6; }
            90% { opacity: 0.6; }
            100% { transform: translateY(-100px) rotate(360deg); opacity: 0; }
        }

        /* Premium Glass Cards */
        .glass-card {
            background: var(--glass-bg);
            backdrop-filter: blur(20px);
            border: 1px solid var(--glass-border);
            border-radius: 20px;
            box-shadow: var(--glass-shadow);
            transition: all 0.3s ease;
        }

        .glass-card:hover {
            border-color: rgba(99, 102, 241, 0.4);
            box-shadow: var(--shadow-hover), var(--shadow-glow);
            transform: translateY(-2px);
        }

        /* Revolutionary Header */
        .header-revolutionary {
            background: rgba(15, 15, 35, 0.95);
            backdrop-filter: blur(20px);
            border-bottom: 1px solid rgba(99, 102, 241, 0.2);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
        }

        /* Premium Navigation Tabs */
        .nav-tabs {
            background: rgba(26, 26, 46, 0.9);
            backdrop-filter: blur(15px);
            border-radius: 15px;
            border: 1px solid rgba(99, 102, 241, 0.15);
            padding: 8px;
        }

        .tab-button {
            padding: 12px 20px;
            border-radius: 10px;
            font-weight: 500;
            transition: all 0.3s ease;
            border: 1px solid transparent;
            position: relative;
            overflow: hidden;
        }

        .tab-button:hover {
            background: rgba(99, 102, 241, 0.1);
            border-color: rgba(99, 102, 241, 0.3);
            transform: translateY(-1px);
        }

        .tab-button.active {
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            color: white;
            border-color: var(--primary);
            box-shadow: 0 5px 15px rgba(99, 102, 241, 0.4);
        }

        .tab-button.active::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(45deg, transparent, rgba(255, 255, 255, 0.1), transparent);
            animation: shimmer 2s ease-in-out infinite;
        }

        @keyframes shimmer {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }

        /* Priority Queue Sidebar - Hidden by default (content now in Overview) */
        .priority-queue {
            position: fixed;
            left: 0;
            top: 0;
            height: 100vh;
            width: 320px;
            background: rgba(15, 15, 35, 0.95);
            backdrop-filter: blur(20px);
            border-right: 1px solid rgba(99, 102, 241, 0.2);
            z-index: 30;
            padding: 100px 20px 20px;
            overflow-y: auto;
            transition: transform 0.3s ease;
            transform: translateX(-100%);
            display: none;
        }

        .priority-queue.collapsed {
            transform: translateX(-280px);
        }

        .priority-item {
            background: rgba(26, 26, 46, 0.8);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(99, 102, 241, 0.1);
            border-radius: 16px;
            padding: 20px;
            margin-bottom: 12px;
            transition: all 0.3s ease;
            cursor: pointer;
            position: relative;
            overflow: hidden;
        }

        .priority-item::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(99, 102, 241, 0.1), transparent);
            transition: left 0.6s ease;
        }

        .priority-item:hover::before {
            left: 100%;
        }

        .priority-item:hover {
            transform: translateY(-4px);
            border-color: rgba(99, 102, 241, 0.3);
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.4), 0 0 20px rgba(99, 102, 241, 0.2);
        }

        .priority-item.critical {
            border-left: 4px solid var(--danger);
            background: linear-gradient(135deg, rgba(239, 68, 68, 0.15), rgba(26, 26, 46, 0.8));
        }

        .priority-item.critical:hover {
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.4), 0 0 25px rgba(239, 68, 68, 0.3);
        }

        .priority-item.high {
            border-left: 4px solid var(--warning);
            background: linear-gradient(135deg, rgba(245, 158, 11, 0.15), rgba(26, 26, 46, 0.8));
        }

        .priority-item.high:hover {
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.4), 0 0 25px rgba(245, 158, 11, 0.3);
        }

        .priority-item.loading {
            background: linear-gradient(90deg, rgba(26, 26, 46, 0.5), rgba(99, 102, 241, 0.1), rgba(26, 26, 46, 0.5));
            background-size: 200% 100%;
            animation: loadingShimmer 1.5s ease-in-out infinite;
        }

        @keyframes loadingShimmer {
            0% { background-position: 200% 0; }
            100% { background-position: -200% 0; }
        }

        /* At-Risk Customer Cards (Wireframe Style) */
        .at-risk-customer-card {
            background: rgba(26, 26, 46, 0.6);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(99, 102, 241, 0.15);
            border-left: 4px solid rgba(99, 102, 241, 0.5);
            border-radius: 12px;
            padding: 20px;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .at-risk-customer-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(99, 102, 241, 0.1), transparent);
            transition: left 0.6s ease;
        }

        .at-risk-customer-card:hover::before {
            left: 100%;
        }

        .at-risk-customer-card:hover {
            transform: translateY(-2px);
            border-left-color: var(--primary);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5), 0 0 20px rgba(99, 102, 241, 0.2);
        }

        .at-risk-customer-card.critical {
            border-left-color: var(--danger);
            background: linear-gradient(135deg, rgba(239, 68, 68, 0.08), rgba(26, 26, 46, 0.6));
        }

        .at-risk-customer-card.critical:hover {
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5), 0 0 25px rgba(239, 68, 68, 0.3);
        }

        .at-risk-customer-card.high {
            border-left-color: var(--warning);
            background: linear-gradient(135deg, rgba(245, 158, 11, 0.08), rgba(26, 26, 46, 0.6));
        }

        .at-risk-customer-card.high:hover {
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5), 0 0 25px rgba(245, 158, 11, 0.3);
        }

        .at-risk-customer-card.loading {
            background: linear-gradient(90deg, rgba(26, 26, 46, 0.5), rgba(99, 102, 241, 0.1), rgba(26, 26, 46, 0.5));
            background-size: 200% 100%;
            animation: loadingShimmer 1.5s ease-in-out infinite;
            min-height: 100px;
        }

        /* Rank Badge */
        .rank-badge {
            width: 36px;
            height: 36px;
            border-radius: 8px;
            background: linear-gradient(135deg, rgba(99, 102, 241, 0.3), rgba(99, 102, 241, 0.1));
            border: 1px solid rgba(99, 102, 241, 0.4);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
            color: var(--primary-light);
            flex-shrink: 0;
        }

        .rank-badge.top-3 {
            background: linear-gradient(135deg, rgba(239, 68, 68, 0.4), rgba(245, 158, 11, 0.3));
            border-color: rgba(239, 68, 68, 0.6);
            color: #fca5a5;
            font-weight: 700;
            box-shadow: 0 0 15px rgba(239, 68, 68, 0.3);
            animation: rankPulse 2s ease-in-out infinite;
        }

        @keyframes rankPulse {
            0%, 100% { 
                box-shadow: 0 0 15px rgba(239, 68, 68, 0.3); 
            }
            50% { 
                box-shadow: 0 0 25px rgba(239, 68, 68, 0.5), 0 0 35px rgba(239, 68, 68, 0.3); 
            }
        }

        /* Main Content Area - Full width (no sidebar) */
        .main-content {
            margin-left: 0;
            padding: 20px;
            transition: margin-left 0.3s ease;
        }

        .main-content.expanded {
            margin-left: 0;
        }

        /* Stats Cards - Revolutionary Style */
        .stat-card {
            background: var(--glass-bg);
            backdrop-filter: blur(15px);
            border: 1px solid rgba(99, 102, 241, 0.15);
            border-radius: 16px;
            padding: 24px;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .stat-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(90deg, var(--primary), var(--secondary), var(--accent));
        }

        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: var(--shadow-hover), var(--shadow-glow);
            border-color: rgba(99, 102, 241, 0.3);
        }

        /* Risk Distribution Chart - Premium Styling */
        .chart-container {
            background: var(--glass-bg);
            backdrop-filter: blur(15px);
            border: 1px solid rgba(99, 102, 241, 0.15);
            border-radius: 20px;
            padding: 30px;
            position: relative;
        }

        .chart-container::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            border-radius: 20px;
            background: linear-gradient(45deg, transparent, rgba(99, 102, 241, 0.05), transparent);
            pointer-events: none;
        }

        /* Agent Pipeline - Revolutionary Design */
        .agent-pipeline {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 20px;
            margin: 30px 0;
        }

        .agent-card {
            background: var(--glass-bg);
            backdrop-filter: blur(15px);
            border: 2px solid;
            border-radius: 16px;
            padding: 24px;
            text-align: center;
            transition: all 0.4s ease;
            position: relative;
            overflow: hidden;
        }

        /* Bodha - Context Agent (Blue/Cyan - Analytical & Observant) */
        .agent-card:nth-child(1) {
            border-color: rgba(59, 130, 246, 0.3);
            background: linear-gradient(135deg, rgba(59, 130, 246, 0.08), var(--glass-bg));
        }
        .agent-card:nth-child(1)::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, #3b82f6, #06b6d4);
        }
        .agent-card:nth-child(1) .agent-icon {
            background: linear-gradient(135deg, #3b82f6, #06b6d4);
            box-shadow: 0 10px 30px rgba(59, 130, 246, 0.4);
        }
        .agent-card:nth-child(1):hover {
            border-color: rgba(59, 130, 246, 0.6);
            transform: translateY(-5px);
            box-shadow: 0 15px 40px rgba(59, 130, 246, 0.3);
        }

        /* Dhyana - Pattern Agent (Purple/Violet - Deep & Insightful) */
        .agent-card:nth-child(2) {
            border-color: rgba(139, 92, 246, 0.3);
            background: linear-gradient(135deg, rgba(139, 92, 246, 0.08), var(--glass-bg));
        }
        .agent-card:nth-child(2)::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, #8b5cf6, #a78bfa);
        }
        .agent-card:nth-child(2) .agent-icon {
            background: linear-gradient(135deg, #8b5cf6, #a78bfa);
            box-shadow: 0 10px 30px rgba(139, 92, 246, 0.4);
        }
        .agent-card:nth-child(2):hover {
            border-color: rgba(139, 92, 246, 0.6);
            transform: translateY(-5px);
            box-shadow: 0 15px 40px rgba(139, 92, 246, 0.3);
        }

        /* Niti - Decision Agent (Orange/Amber - Decisive & Strategic) */
        .agent-card:nth-child(3) {
            border-color: rgba(251, 146, 60, 0.3);
            background: linear-gradient(135deg, rgba(251, 146, 60, 0.08), var(--glass-bg));
        }
        .agent-card:nth-child(3)::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, #fb923c, #fbbf24);
        }
        .agent-card:nth-child(3) .agent-icon {
            background: linear-gradient(135deg, #fb923c, #fbbf24);
            box-shadow: 0 10px 30px rgba(251, 146, 60, 0.4);
        }
        .agent-card:nth-child(3):hover {
            border-color: rgba(251, 146, 60, 0.6);
            transform: translateY(-5px);
            box-shadow: 0 15px 40px rgba(251, 146, 60, 0.3);
        }

        /* Karuna - Empathy Agent (Pink/Rose - Warm & Compassionate) */
        .agent-card:nth-child(4) {
            border-color: rgba(236, 72, 153, 0.3);
            background: linear-gradient(135deg, rgba(236, 72, 153, 0.08), var(--glass-bg));
        }
        .agent-card:nth-child(4)::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, #ec4899, #f472b6);
        }
        .agent-card:nth-child(4) .agent-icon {
            background: linear-gradient(135deg, #ec4899, #f472b6);
            box-shadow: 0 10px 30px rgba(236, 72, 153, 0.4);
        }
        .agent-card:nth-child(4):hover {
            border-color: rgba(236, 72, 153, 0.6);
            transform: translateY(-5px);
            box-shadow: 0 15px 40px rgba(236, 72, 153, 0.3);
        }

        .agent-card.active {
            transform: scale(1.05);
        }

        .agent-card.processing {
            animation: agentPulse 2s ease-in-out infinite;
        }
        
        .agent-card.completed {
            opacity: 0.7;
            border-color: #10b981 !important;
        }
        
        .agent-card.completed .agent-icon {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
        }

        @keyframes agentPulse {
            0%, 100% { box-shadow: 0 0 20px currentColor; }
            50% { box-shadow: 0 0 40px currentColor; }
        }

        .agent-icon {
            width: 70px;
            height: 70px;
            border-radius: 50%;
            display: flex;
            position: relative;
            align-items: center;
            justify-content: center;
            margin: 0 auto 15px;
            font-size: 28px;
            color: white;
            transition: all 0.3s ease;
        }

        /* NEW AGENT DESIGN - NO CONTAINERS, DIRECT ON SCREEN */
        .agent-card-new {
            position: relative;
            padding: 100px 0 20px 0;
            background: transparent;
            border: none;
            transition: all 0.4s ease;
            text-align: center;
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 320px;
        }

        /* Magnificent White Glow Around Character */
        .agent-glow {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 200px;
            height: 200px;
            background: radial-gradient(circle, rgba(255, 255, 255, 0.8) 0%, rgba(255, 255, 255, 0.4) 40%, rgba(255, 255, 255, 0.1) 70%, transparent 100%);
            opacity: 0;
            transition: opacity 0.5s ease;
            z-index: 0;
            border-radius: 50%;
            filter: blur(2px);
        }

        .agent-card-new.processing .agent-glow {
            opacity: 1;
            animation: magnificentGlow 3s ease-in-out infinite;
        }

        @keyframes magnificentGlow {
            0%, 100% { 
                transform: translate(-50%, -50%) scale(1);
                opacity: 0.8;
                filter: blur(2px);
            }
            50% { 
                transform: translate(-50%, -50%) scale(1.4);
                opacity: 1;
                filter: blur(3px);
            }
        }

        /* Toast Notification System */
        .toast-container {
            position: fixed;
            top: 24px;
            right: 24px;
            z-index: 9999;
            pointer-events: none;
        }

        .toast {
            background: linear-gradient(
                135deg,
                rgba(255, 255, 255, 0.1) 0%,
                rgba(255, 255, 255, 0.05) 100%
            );
            backdrop-filter: blur(24px) saturate(180%);
            -webkit-backdrop-filter: blur(24px) saturate(180%);
            border: 1px solid rgba(255, 255, 255, 0.18);
            border-radius: 20px;
            color: white;
            padding: 20px 24px;
            margin-bottom: 16px;
            box-shadow: 
                0 8px 32px rgba(0, 0, 0, 0.5),
                0 2px 8px rgba(0, 0, 0, 0.3),
                inset 0 1px 1px rgba(255, 255, 255, 0.2),
                inset 0 -1px 1px rgba(0, 0, 0, 0.1);
            pointer-events: auto;
            transform: translateX(450px) scale(0.9);
            opacity: 0;
            transition: all 0.6s cubic-bezier(0.34, 1.56, 0.64, 1);
            max-width: 420px;
            min-width: 340px;
            position: relative;
            overflow: hidden;
        }

        .toast::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(
                90deg,
                transparent,
                rgba(255, 255, 255, 0.1),
                transparent
            );
            transition: left 0.5s;
        }

        .toast:hover::before {
            left: 100%;
        }

        .toast.show {
            transform: translateX(0) scale(1);
            opacity: 1;
        }

        .toast.hide {
            transform: translateX(450px) scale(0.9);
            opacity: 0;
        }

        .toast-header {
            display: flex;
            align-items: center;
            gap: 12px;
            font-weight: 700;
            font-size: 16px;
            margin-bottom: 8px;
            color: #fff;
            text-shadow: 0 2px 8px rgba(0, 0, 0, 0.4);
            letter-spacing: 0.3px;
        }

        .toast-body {
            font-size: 14px;
            opacity: 0.92;
            line-height: 1.6;
            color: rgba(255, 255, 255, 0.95);
            padding-left: 32px;
            font-weight: 400;
        }

        .toast-icon {
            width: 22px;
            height: 22px;
            flex-shrink: 0;
            filter: drop-shadow(0 2px 6px rgba(0, 0, 0, 0.4));
            animation: iconPulse 2s ease-in-out infinite;
        }

        @keyframes iconPulse {
            0%, 100% {
                transform: scale(1);
                filter: drop-shadow(0 2px 6px rgba(0, 0, 0, 0.4));
            }
            50% {
                transform: scale(1.1);
                filter: drop-shadow(0 4px 12px rgba(255, 255, 255, 0.3));
            }
        }

        /* Success toast accent */
        .toast[data-type="success"] {
            border-left: 3px solid rgba(16, 185, 129, 0.8);
            background: linear-gradient(
                135deg,
                rgba(16, 185, 129, 0.15) 0%,
                rgba(255, 255, 255, 0.05) 100%
            );
        }

        /* Info toast accent */
        .toast[data-type="info"] {
            border-left: 3px solid rgba(59, 130, 246, 0.8);
            background: linear-gradient(
                135deg,
                rgba(59, 130, 246, 0.15) 0%,
                rgba(255, 255, 255, 0.05) 100%
            );
        }

        /* Error toast accent */
        .toast[data-type="error"] {
            border-left: 3px solid rgba(239, 68, 68, 0.8);
            background: linear-gradient(
                135deg,
                rgba(239, 68, 68, 0.15) 0%,
                rgba(255, 255, 255, 0.05) 100%
            );
        }

        /* Agent Image Container */
        .agent-image-container {
            position: relative;
            width: 150px;
            height: 150px;
            margin: 0 auto 20px;
            z-index: 2;
        }

        .agent-image {
            width: 100%;
            height: 100%;
            object-fit: contain;
            filter: drop-shadow(0 4px 20px rgba(0, 0, 0, 0.5));
            transition: transform 0.3s ease;
        }

        .agent-card-new.processing .agent-image {
            transform: scale(1.1);
        }

        .agent-card-new.completed .agent-image {
            filter: drop-shadow(0 4px 20px rgba(16, 185, 129, 0.6));
        }

        /* Check Mark for Completed */
        .agent-check-mark {
            position: absolute;
            top: 0;
            right: 0;
            font-size: 30px;
            color: #10b981;
            background: white;
            border-radius: 50%;
            padding: 2px;
        }

        /* Agent Name and Role */
        .agent-name {
            font-size: 20px;
            font-weight: bold;
            color: white;
            margin-bottom: 5px;
            z-index: 2;
            position: relative;
        }

        .agent-role {
            font-size: 13px;
            color: #94a3b8;
            z-index: 2;
            position: relative;
        }

        /* Exact React Atom Animation - Above Agent's Head */
        .agent-atom {
            position: absolute;
            top: -80px;
            left: 50%;
            transform: translateX(-50%);
            width: 120px;
            height: 120px;
            z-index: 6;
            display: none;
        }

        .agent-card-new.processing .agent-atom {
            display: block;
        }

        .atom-core {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 8px;
            height: 8px;
            background: #61dafb;
            border-radius: 50%;
            box-shadow: 0 0 10px #61dafb, 0 0 20px rgba(97, 218, 251, 0.6);
            animation: atomCorePulse 2s ease-in-out infinite;
        }

        @keyframes atomCorePulse {
            0%, 100% { 
                transform: translate(-50%, -50%) scale(1);
                box-shadow: 0 0 10px #61dafb, 0 0 20px rgba(97, 218, 251, 0.6);
            }
            50% { 
                transform: translate(-50%, -50%) scale(1.5);
                box-shadow: 0 0 15px #61dafb, 0 0 30px rgba(97, 218, 251, 0.9);
            }
        }

        .atom-orbit {
            position: absolute;
            top: 50%;
            left: 50%;
            border: 1px solid #61dafb;
            border-radius: 50%;
            opacity: 0.6;
        }

        /* Elliptical orbits like React logo */
        .atom-orbit-1 {
            width: 120px;
            height: 30px;
            transform: translate(-50%, -50%) rotateX(60deg) rotateY(0deg);
            animation: reactOrbit1 2s linear infinite;
        }

        .atom-orbit-2 {
            width: 120px;
            height: 30px;
            transform: translate(-50%, -50%) rotateX(60deg) rotateY(120deg);
            animation: reactOrbit2 2s linear infinite;
        }

        .atom-orbit-3 {
            width: 120px;
            height: 30px;
            transform: translate(-50%, -50%) rotateX(60deg) rotateY(240deg);
            animation: reactOrbit3 2s linear infinite;
        }

        .atom-orbit::after {
            content: '';
            position: absolute;
            top: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 8px;
            height: 8px;
            background: #6366f1;
            border-radius: 50%;
            box-shadow: 0 0 10px #6366f1;
        }

        /* React-style Electrons */
        .electron {
            position: absolute;
            width: 6px;
            height: 6px;
            background: #61dafb;
            border-radius: 50%;
            box-shadow: 0 0 6px #61dafb;
            animation: electronGlow 1s ease-in-out infinite alternate;
        }

        .electron-1 {
            top: -3px;
            right: -3px;
        }

        .electron-2 {
            top: -3px;
            right: -3px;
        }

        .electron-3 {
            top: -3px;
            right: -3px;
        }

        @keyframes electronGlow {
            0% { 
                box-shadow: 0 0 6px #61dafb;
                transform: scale(1);
            }
            100% { 
                box-shadow: 0 0 12px #61dafb, 0 0 20px rgba(97, 218, 251, 0.5);
                transform: scale(1.2);
            }
        }

        /* React-style orbital rotations */
        @keyframes reactOrbit1 {
            from { transform: translate(-50%, -50%) rotateX(60deg) rotateY(0deg) rotateZ(0deg); }
            to { transform: translate(-50%, -50%) rotateX(60deg) rotateY(0deg) rotateZ(360deg); }
        }

        @keyframes reactOrbit2 {
            from { transform: translate(-50%, -50%) rotateX(60deg) rotateY(120deg) rotateZ(0deg); }
            to { transform: translate(-50%, -50%) rotateX(60deg) rotateY(120deg) rotateZ(360deg); }
        }

        @keyframes reactOrbit3 {
            from { transform: translate(-50%, -50%) rotateX(60deg) rotateY(240deg) rotateZ(0deg); }
            to { transform: translate(-50%, -50%) rotateX(60deg) rotateY(240deg) rotateZ(360deg); }
        }

        /* Badge Styles - Premium */
        .badge {
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 11px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            display: inline-block;
            position: relative;
            overflow: hidden;
        }

        .badge::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            animation: badgeShine 2s ease-in-out infinite;
        }

        @keyframes badgeShine {
            0% { left: -100%; }
            100% { left: 100%; }
        }

        .badge-critical { 
            background: linear-gradient(135deg, rgba(239, 68, 68, 0.3), rgba(239, 68, 68, 0.1)); 
            color: #fca5a5; 
            border: 1px solid rgba(239, 68, 68, 0.4); 
        }

        .badge-high { 
            background: linear-gradient(135deg, rgba(245, 158, 11, 0.3), rgba(245, 158, 11, 0.1)); 
            color: #fcd34d; 
            border: 1px solid rgba(245, 158, 11, 0.4); 
        }

        .badge-warning { 
            background: linear-gradient(135deg, rgba(251, 146, 60, 0.3), rgba(251, 146, 60, 0.1)); 
            color: #fdba74; 
            border: 1px solid rgba(251, 146, 60, 0.4); 
        }

        .badge-success { 
            background: linear-gradient(135deg, rgba(16, 185, 129, 0.3), rgba(16, 185, 129, 0.1)); 
            color: #6ee7b7; 
            border: 1px solid rgba(16, 185, 129, 0.4); 
        }

        .badge-glow {
            animation: badgeGlow 2s ease-in-out infinite;
        }

        @keyframes badgeGlow {
            0%, 100% { 
                box-shadow: 0 0 10px currentColor; 
            }
            50% { 
                box-shadow: 0 0 20px currentColor, 0 0 30px currentColor; 
            }
        }

        /* Button Styles - Revolutionary */
        .btn {
            padding: 12px 24px;
            border-radius: 12px;
            font-weight: 600;
            transition: all 0.3s ease;
            border: none;
            cursor: pointer;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            position: relative;
            overflow: hidden;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            font-size: 14px;
        }

        .btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            transition: left 0.5s ease;
        }

        .btn:hover::before {
            left: 100%;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            color: white;
            box-shadow: 0 5px 15px rgba(99, 102, 241, 0.4);
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(99, 102, 241, 0.5);
        }

        .btn-scan {
            background: linear-gradient(135deg, var(--success), #059669);
            color: white;
            box-shadow: 0 5px 15px rgba(16, 185, 129, 0.4);
            animation: scanPulse 3s ease-in-out infinite;
        }

        @keyframes scanPulse {
            0%, 100% { box-shadow: 0 5px 15px rgba(16, 185, 129, 0.4); }
            50% { box-shadow: 0 10px 30px rgba(16, 185, 129, 0.6); }
        }

        /* Progress Bar - Revolutionary */
        .progress-bar {
            height: 8px;
            background: rgba(99, 102, 241, 0.1);
            border-radius: 4px;
            overflow: hidden;
            position: relative;
        }

        .progress-fill {
            height: 100%;
            transition: width 0.5s ease;
            border-radius: 4px;
            position: relative;
            overflow: hidden;
        }

        .progress-fill::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.3), transparent);
            animation: progressShine 2s ease-in-out infinite;
        }

        @keyframes progressShine {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }

        .progress-critical { background: linear-gradient(90deg, #ef4444, #dc2626); }
        .progress-high { background: linear-gradient(90deg, #f59e0b, #d97706); }
        .progress-success { background: linear-gradient(90deg, #10b981, #059669); }

        /* Responsive Design */
        @media (max-width: 1024px) {
            .priority-queue {
                transform: translateX(-280px);
            }
            .main-content {
                margin-left: 60px;
            }
            .agent-pipeline {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        @media (max-width: 768px) {
            .priority-queue {
                transform: translateX(-320px);
            }
            .main-content {
                margin-left: 20px;
            }
            .agent-pipeline {
                grid-template-columns: 1fr;
            }
        }

        /* Custom Scrollbars */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }

        ::-webkit-scrollbar-track {
            background: rgba(26, 26, 46, 0.5);
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: linear-gradient(135deg, var(--primary-dark), var(--secondary));
        }

        /* Loading States */
        .loading {
            background: linear-gradient(90deg, rgba(99, 102, 241, 0.1) 25%, rgba(99, 102, 241, 0.2) 50%, rgba(99, 102, 241, 0.1) 75%);
            background-size: 200% 100%;
            animation: loading 1.5s ease-in-out infinite;
            border-radius: 8px;
        }

        @keyframes loading {
            0% { background-position: 200% 0; }
            100% { background-position: -200% 0; }
        }

        /* Notification Styles */
        .notification {
            background: var(--glass-bg);
            backdrop-filter: blur(15px);
            border: 1px solid rgba(99, 102, 241, 0.2);
            border-radius: 12px;
            padding: 16px;
            margin-bottom: 12px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.3);
            animation: slideInRight 0.3s ease-out;
        }

        @keyframes slideInRight {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }

        /* Toggle Button for Sidebar - Hidden (sidebar content moved to Overview) */
        .sidebar-toggle {
            display: none;
        }

        /* Toast Notifications */
        .toast-container {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 9999;
            display: flex;
            flex-direction: column;
            gap: 12px;
            pointer-events: none;
        }

        .toast {
            background: rgba(26, 26, 46, 0.95);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(99, 102, 241, 0.3);
            border-radius: 12px;
            padding: 16px 20px;
            min-width: 320px;
            max-width: 400px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: center;
            gap: 12px;
            animation: slideInRight 0.3s ease-out;
            pointer-events: all;
        }

        .toast.success {
            border-color: rgba(16, 185, 129, 0.5);
            background: linear-gradient(135deg, rgba(16, 185, 129, 0.1), rgba(26, 26, 46, 0.95));
        }

        .toast.error {
            border-color: rgba(239, 68, 68, 0.5);
            background: linear-gradient(135deg, rgba(239, 68, 68, 0.1), rgba(26, 26, 46, 0.95));
        }

        .toast.info {
            border-color: rgba(59, 130, 246, 0.5);
            background: linear-gradient(135deg, rgba(59, 130, 246, 0.1), rgba(26, 26, 46, 0.95));
        }

        .toast.warning {
            border-color: rgba(245, 158, 11, 0.5);
            background: linear-gradient(135deg, rgba(245, 158, 11, 0.1), rgba(26, 26, 46, 0.95));
        }

        .toast-icon {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
            flex-shrink: 0;
        }

        .toast.success .toast-icon {
            background: rgba(16, 185, 129, 0.2);
            color: #6ee7b7;
        }

        .toast.error .toast-icon {
            background: rgba(239, 68, 68, 0.2);
            color: #fca5a5;
        }

        .toast.info .toast-icon {
            background: rgba(59, 130, 246, 0.2);
            color: #93c5fd;
        }

        .toast.warning .toast-icon {
            background: rgba(245, 158, 11, 0.2);
            color: #fcd34d;
        }

        @keyframes slideInRight {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        @keyframes slideOutRight {
            from {
                transform: translateX(0);
                opacity: 1;
            }
            to {
                transform: translateX(100%);
                opacity: 0;
            }
        }

        .toast.hiding {
            animation: slideOutRight 0.3s ease-in forwards;
        }
    </style>
</head>
<body>
    <!-- Revolutionary Animated Background -->
    <div class="bg-revolutionary"></div>
    
    <!-- Floating Particles -->
    <div class="particles"></div>

    <!-- Main App Container -->
    <div x-data="revolutionaryDashboard()" x-init="init()" class="relative z-10">
        
        <!-- Toast Notification Container -->
        <div class="toast-container">
            <template x-for="toast in toasts" :key="toast.id">
                <div :class="['toast', toast.type, toast.hiding ? 'hiding' : '']">
                    <div class="toast-icon">
                        <i :class="toast.icon"></i>
                    </div>
                    <div class="flex-1">
                        <div class="font-semibold text-white" x-text="toast.title"></div>
                        <div class="text-sm text-gray-300 mt-1" x-text="toast.message"></div>
                    </div>
                </div>
            </template>
        </div>

        <!-- Full Details Modal -->
        <div x-show="showFullDetailsModal" 
             x-cloak
             @click.self="showFullDetailsModal = false"
             class="fixed inset-0 bg-black/70 backdrop-blur-sm z-50 flex items-center justify-center p-4"
             style="display: none;">
            
            <div @click.stop 
                 x-show="showFullDetailsModal"
                 x-transition:enter="transition ease-out duration-300"
                 x-transition:enter-start="opacity-0 transform scale-95"
                 x-transition:enter-end="opacity-100 transform scale-100"
                 x-transition:leave="transition ease-in duration-200"
                 x-transition:leave-start="opacity-100 transform scale-100"
                 x-transition:leave-end="opacity-0 transform scale-95"
                 class="glass-card p-6 max-w-4xl w-full max-h-[90vh] overflow-y-auto">
                
                <!-- Modal Header -->
                <div class="flex items-start justify-between mb-6 pb-6 border-b border-gray-700">
                    <div>
                        <h2 class="text-2xl font-bold text-white mb-2">Customer 360Â° View</h2>
                        <p class="text-sm text-gray-400" x-text="fullDetailsData?.name || 'Loading...'"></p>
                    </div>
                    <button @click="showFullDetailsModal = false" 
                            class="w-10 h-10 rounded-lg bg-gray-800 hover:bg-gray-700 flex items-center justify-center transition-colors">
                        <i class="fas fa-times text-gray-400"></i>
                    </button>
                </div>

                <!-- Loading State -->
                <div x-show="fullDetailsLoading" class="text-center py-12">
                    <i class="fas fa-spinner fa-spin text-4xl text-primary mb-4"></i>
                    <p class="text-gray-400">Loading customer details...</p>
                </div>

                <!-- Content -->
                <div x-show="!fullDetailsLoading && fullDetailsData" class="space-y-6">
                    
                    <!-- Customer Summary -->
                    <div class="grid grid-cols-4 gap-4">
                        <div class="bg-gray-800/50 rounded-lg p-4 border border-gray-700/50">
                            <div class="text-xs text-gray-400 mb-1">Churn Risk</div>
                            <div class="text-2xl font-bold" 
                                 :class="fullDetailsData?.churnRisk >= 80 ? 'text-red-400' : 'text-orange-400'"
                                 x-text="(fullDetailsData?.churnRisk || 0) + '%'"></div>
                        </div>
                        <div class="bg-gray-800/50 rounded-lg p-4 border border-gray-700/50">
                            <div class="text-xs text-gray-400 mb-1">Lifetime Value</div>
                            <div class="text-2xl font-bold text-green-400">
                                $<span x-text="fullDetailsData?.ltv?.toLocaleString() || fullDetailsData?.lifetimeValue?.toLocaleString() || 0"></span>
                            </div>
                        </div>
                        <div class="bg-gray-800/50 rounded-lg p-4 border border-gray-700/50">
                            <div class="text-xs text-gray-400 mb-1">Health Score</div>
                            <div class="text-2xl font-bold text-blue-400" x-text="fullDetailsData?.healthScore || 'N/A'"></div>
                        </div>
                        <div class="bg-gray-800/50 rounded-lg p-4 border border-gray-700/50">
                            <div class="text-xs text-gray-400 mb-1">Segment</div>
                            <div class="text-lg font-bold text-purple-400" x-text="fullDetailsData?.segment || 'N/A'"></div>
                        </div>
                    </div>

                    <!-- Purchase History -->
                    <div>
                        <h3 class="text-lg font-bold text-white mb-4 flex items-center gap-2">
                            <i class="fas fa-shopping-bag text-blue-400"></i>
                            Recent Purchase History
                        </h3>
                        <div class="space-y-3">
                            <template x-for="(purchase, index) in (fullDetailsData?.purchaseHistory || [])" :key="index">
                                <div class="bg-gray-800/30 rounded-lg p-4 border border-gray-700/50">
                                    <div class="flex items-start justify-between">
                                        <div class="flex-1">
                                            <div class="flex items-center gap-3 mb-2">
                                                <span class="text-sm font-semibold text-white" x-text="purchase.date"></span>
                                                <span class="px-2 py-1 rounded text-xs font-medium"
                                                      :class="purchase.status === 'Delivered' ? 'bg-green-500/20 text-green-400' : purchase.status === 'Returned' ? 'bg-red-500/20 text-red-400' : 'bg-blue-500/20 text-blue-400'"
                                                      x-text="purchase.status"></span>
                                            </div>
                                            <div class="text-sm text-gray-400" x-text="purchase.items"></div>
                                        </div>
                                        <div class="text-right">
                                            <div class="text-lg font-bold text-green-400" x-text="'$' + purchase.amount"></div>
                                        </div>
                                    </div>
                                </div>
                            </template>
                            <div x-show="!fullDetailsData?.purchaseHistory || fullDetailsData.purchaseHistory.length === 0" 
                                 class="text-center py-8 text-gray-500">
                                No purchase history available
                            </div>
                        </div>
                    </div>

                    <!-- Support Tickets -->
                    <div>
                        <h3 class="text-lg font-bold text-white mb-4 flex items-center gap-2">
                            <i class="fas fa-headset text-orange-400"></i>
                            Support Ticket History
                        </h3>
                        <div class="space-y-3">
                            <template x-for="(ticket, index) in (fullDetailsData?.supportTickets || [])" :key="index">
                                <div class="bg-gray-800/30 rounded-lg p-4 border border-gray-700/50">
                                    <div class="flex items-start justify-between mb-2">
                                        <div class="flex-1">
                                            <div class="flex items-center gap-3 mb-2">
                                                <span class="text-xs text-gray-500" x-text="'Ticket #' + ticket.id"></span>
                                                <span class="text-sm text-gray-400" x-text="ticket.date"></span>
                                                <span class="px-2 py-1 rounded text-xs font-medium"
                                                      :class="ticket.status === 'RESOLVED' ? 'bg-green-500/20 text-green-400' : 'bg-orange-500/20 text-orange-400'"
                                                      x-text="ticket.status"></span>
                                            </div>
                                            <div class="text-sm text-white font-medium mb-1" x-text="ticket.issue"></div>
                                            <div class="text-xs text-gray-400" x-text="ticket.resolution"></div>
                                        </div>
                                        <div class="text-right ml-4">
                                            <div class="text-xs text-gray-400 mb-1">CSAT</div>
                                            <div class="text-lg font-bold"
                                                 :class="ticket.csat >= 4 ? 'text-green-400' : ticket.csat >= 3 ? 'text-yellow-400' : 'text-red-400'"
                                                 x-text="ticket.csat + '/5'"></div>
                                        </div>
                                    </div>
                                </div>
                            </template>
                            <div x-show="!fullDetailsData?.supportTickets || fullDetailsData.supportTickets.length === 0" 
                                 class="text-center py-8 text-gray-500">
                                No support tickets found
                            </div>
                        </div>
                    </div>

                    <!-- NPS Trend -->
                    <div>
                        <h3 class="text-lg font-bold text-white mb-4 flex items-center gap-2">
                            <i class="fas fa-chart-line text-pink-400"></i>
                            NPS & Sentiment Trend
                        </h3>
                        <div class="bg-gray-800/30 rounded-lg p-6 border border-gray-700/50">
                            <div class="grid grid-cols-3 gap-6">
                                <div class="text-center">
                                    <div class="text-xs text-gray-400 mb-2">Current NPS</div>
                                    <div class="text-3xl font-bold"
                                         :class="(fullDetailsData?.nps?.current || 0) >= 7 ? 'text-green-400' : (fullDetailsData?.nps?.current || 0) >= 5 ? 'text-yellow-400' : 'text-red-400'"
                                         x-text="(fullDetailsData?.nps?.current || 0) + '/10'"></div>
                                    <div class="text-xs text-gray-500 mt-1" 
                                         x-text="(fullDetailsData?.nps?.current || 0) >= 9 ? 'Promoter' : (fullDetailsData?.nps?.current || 0) >= 7 ? 'Passive' : 'Detractor'"></div>
                                </div>
                                <div class="text-center">
                                    <div class="text-xs text-gray-400 mb-2">Previous NPS</div>
                                    <div class="text-3xl font-bold text-gray-500" x-text="(fullDetailsData?.nps?.previous || 0) + '/10'"></div>
                                    <div class="text-xs text-gray-500 mt-1">Historical</div>
                                </div>
                                <div class="text-center">
                                    <div class="text-xs text-gray-400 mb-2">Trend</div>
                                    <div class="text-3xl font-bold"
                                         :class="(fullDetailsData?.nps?.current || 0) >= (fullDetailsData?.nps?.previous || 0) ? 'text-green-400' : 'text-red-400'">
                                        <i :class="(fullDetailsData?.nps?.current || 0) >= (fullDetailsData?.nps?.previous || 0) ? 'fas fa-arrow-up' : 'fas fa-arrow-down'"></i>
                                    </div>
                                    <div class="text-xs text-gray-500 mt-1" 
                                         x-text="(fullDetailsData?.nps?.current || 0) >= (fullDetailsData?.nps?.previous || 0) ? 'Improving' : 'Declining'"></div>
                                </div>
                            </div>
                        </div>
                    </div>

                </div>

                <!-- Modal Footer -->
                <div class="flex justify-end gap-3 mt-6 pt-6 border-t border-gray-700">
                    <button @click="showFullDetailsModal = false" 
                            class="px-6 py-3 rounded-lg bg-gray-700 hover:bg-gray-600 text-white font-semibold transition-all">
                        Close
                    </button>
                </div>
            </div>
        </div>
        
        <!-- Sidebar Toggle Button -->
        <button @click="sidebarCollapsed = !sidebarCollapsed" class="sidebar-toggle">
            <i class="fas fa-bars" x-show="sidebarCollapsed"></i>
            <i class="fas fa-times" x-show="!sidebarCollapsed"></i>
        </button>

        <!-- Priority Queue Sidebar -->
        <div class="priority-queue" :class="{ 'collapsed': sidebarCollapsed }">
            <div class="mb-6">
                <h2 class="text-xl font-bold text-white mb-4 flex items-center gap-2">
                    <i class="fas fa-exclamation-triangle text-warning"></i>
                    Priority Queue
                </h2>
                <p class="text-sm text-gray-400 mb-4">Critical customers requiring immediate attention</p>
            </div>

            <div class="space-y-3">
                <template x-for="customer in priorityQueue" :key="customer.id">
                    <div class="priority-item" :class="customer.priority" @click="selectPriorityCustomer(customer)">
                        <div class="flex items-start justify-between mb-2">
                            <div>
                                <h3 class="font-semibold text-white text-sm" x-text="customer.name"></h3>
                                <p class="text-xs text-gray-400" x-text="customer.segment"></p>
                            </div>
                            <span class="badge" :class="'badge-' + customer.priority" x-text="customer.priority"></span>
                        </div>
                        
                        <div class="mb-3">
                            <div class="flex justify-between text-xs text-gray-400 mb-1">
                                <span>Churn Risk</span>
                                <span x-text="customer.churnRisk + '%'"></span>
                            </div>
                            <div class="progress-bar">
                                <div class="progress-fill progress-critical" :style="`width: ${customer.churnRisk}%`"></div>
                            </div>
                        </div>

                        <div class="flex justify-between text-xs">
                            <span class="text-gray-400">LTV: <span class="text-green-400" x-text="'$' + customer.ltv.toLocaleString()"></span></span>
                            <span class="text-gray-400">Health: <span class="text-blue-400" x-text="customer.healthScore + '%'"></span></span>
                        </div>
                    </div>
                </template>

                <!-- Loading State -->
                <template x-show="priorityQueue.length === 0">
                    <div class="space-y-3">
                        <div class="priority-item loading h-20"></div>
                        <div class="priority-item loading h-20"></div>
                        <div class="priority-item loading h-20"></div>
                    </div>
                </template>
            </div>
        </div>

        <!-- Main Content Area -->
        <div class="main-content" :class="{ 'expanded': sidebarCollapsed }">
            
            <!-- Revolutionary Header -->
            <header class="header-revolutionary glass-card sticky top-0 z-30 mb-8">
                <div class="px-8 py-6">
                    <div class="flex items-center justify-between">
                        <!-- Logo & Title -->
                        <div class="flex items-center gap-6">
                            <div class="flex items-center gap-4">
                                <div class="w-12 h-12 rounded-xl bg-gradient-to-br from-primary to-secondary flex items-center justify-center">
                                    <i class="fas fa-brain text-white text-xl"></i>
                                </div>
                                <div>
                                    <h1 class="text-2xl font-bold text-white">
                                        ProCX
                                    </h1>
                                    <p class="text-sm text-gray-400">AI-Powered Customer Experience Revolution</p>
                                </div>
                            </div>
                        </div>

                        <!-- Header Actions -->
                        <div class="flex items-center gap-6">
                            <!-- Scan Button -->
                            <button @click="runProactiveScan()" 
                                    class="btn btn-scan" 
                                    :disabled="scanInProgress">
                                <i class="fas fa-rocket"></i>
                                <span x-text="scanInProgress ? 'Processing...' : 'Process Customers'"></span>
                            </button>
                        </div>
                    </div>
                </div>
            </header>

            <!-- Revolutionary Stats Grid -->
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-6 mb-8">
                <!-- Total Customers -->
                <div class="stat-card">
                    <div class="flex items-center justify-between mb-4">
                        <div class="w-12 h-12 rounded-xl bg-gradient-to-br from-blue-500 to-blue-600 flex items-center justify-center">
                            <i class="fas fa-users text-white"></i>
                        </div>
                        <div class="text-right">
                            <div class="text-2xl font-bold" x-text="stats.totalCustomers.toLocaleString()">0</div>
                            <div class="text-xs text-gray-400">Total Customers</div>
                        </div>
                    </div>
                </div>

                <!-- Health Score -->
                <div class="stat-card">
                    <div class="flex items-center justify-between mb-4">
                        <div class="w-12 h-12 rounded-xl bg-gradient-to-br from-green-500 to-green-600 flex items-center justify-center">
                            <i class="fas fa-heart text-white"></i>
                        </div>
                        <div class="text-right">
                            <div class="text-2xl font-bold text-green-400" x-text="stats.avgHealthScore + '%'">0%</div>
                            <div class="text-xs text-gray-400">Avg Health Score</div>
                        </div>
                    </div>
                    <div class="progress-bar">
                        <div class="progress-fill progress-success" :style="`width: ${stats.avgHealthScore}%`"></div>
                    </div>
                </div>

                <!-- At Risk -->
                <div class="stat-card">
                    <div class="flex items-center justify-between mb-4">
                        <div class="w-12 h-12 rounded-xl bg-gradient-to-br from-orange-500 to-red-500 flex items-center justify-center">
                            <i class="fas fa-exclamation-triangle text-white"></i>
                        </div>
                        <div class="text-right">
                            <div class="text-2xl font-bold text-orange-400" x-text="stats.atRisk">0</div>
                            <div class="text-xs text-gray-400">At Risk Now</div>
                        </div>
                    </div>
                </div>

                <!-- AI Interventions -->
                <div class="stat-card">
                    <div class="flex items-center justify-between mb-4">
                        <div class="w-12 h-12 rounded-xl bg-gradient-to-br from-purple-500 to-purple-600 flex items-center justify-center">
                            <i class="fas fa-robot text-white"></i>
                        </div>
                        <div class="text-right">
                            <div class="text-2xl font-bold text-purple-400" x-text="stats.aiInterventions">0</div>
                            <div class="text-xs text-gray-400">AI Interventions</div>
                        </div>
                    </div>
                </div>

                <!-- Active Escalations (NEW) -->
                <div class="stat-card">
                    <div class="flex items-center justify-between mb-4">
                        <div class="w-12 h-12 rounded-xl bg-gradient-to-br from-red-500 to-red-600 flex items-center justify-center">
                            <i class="fas fa-user-shield text-white"></i>
                        </div>
                        <div class="text-right">
                            <div class="text-2xl font-bold text-red-400" x-text="stats.escalated">0</div>
                            <div class="text-xs text-gray-400">Active Escalations</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Tab Navigation -->
            <div class="flex justify-center mb-8">
                <div class="inline-flex gap-2 bg-gray-800/50 backdrop-blur-sm rounded-xl p-1.5 border border-gray-700/50">
                    <button @click="activeTab = 'overview'" 
                            :class="activeTab === 'overview' ? 'active' : ''"
                            class="tab-button flex items-center gap-2">
                        <i class="fas fa-chart-line"></i>
                        <span>Overview</span>
                    </button>
                    <button @click="activeTab = 'proactive'" 
                            :class="activeTab === 'proactive' ? 'active' : ''"
                            class="tab-button flex items-center gap-2">
                        <i class="fas fa-brain"></i>
                        <span>Agents</span>
                        <span class="badge badge-success" x-show="stats.aiInterventions > 0" x-text="stats.aiInterventions"></span>
                    </button>
                    <button @click="activeTab = 'atRisk'" 
                            :class="activeTab === 'atRisk' ? 'active' : ''"
                            class="tab-button flex items-center gap-2">
                        <i class="fas fa-exclamation-triangle"></i>
                        <span>At-Risk Customers</span>
                        <span class="badge badge-warning" x-show="stats.atRisk > 0" x-text="stats.atRisk"></span>
                    </button>
                    <button @click="activeTab = 'reactive'" 
                            :class="activeTab === 'reactive' ? 'active' : ''"
                            class="tab-button flex items-center gap-2">
                        <i class="fas fa-user-shield"></i>
                        <span>Escalation Queue</span>
                        <span class="badge badge-critical" x-show="stats.escalated > 0" x-text="stats.escalated"></span>
                    </button>
                    <button @click="activeTab = 'history'" 
                            :class="activeTab === 'history' ? 'active' : ''"
                            class="tab-button flex items-center gap-2">
                        <i class="fas fa-history"></i>
                        <span>History</span>
                    </button>
                </div>
            </div>

            <!-- Tab Content -->
            <div>
                <!-- OVERVIEW TAB -->
                <div x-show="activeTab === 'overview'" class="space-y-8">
                    
                    <!-- Main Overview Grid: Priority Queue + Risk Distribution -->
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                        
                        <!-- Priority Queue Section -->
                        <div class="glass-card p-6">
                            <div class="mb-6">
                                <h2 class="text-xl font-bold mb-2 flex items-center gap-2">
                                    <i class="fas fa-exclamation-triangle text-danger"></i>
                                    TOP AT-RISK CUSTOMERS
                                </h2>
                                <p class="text-sm text-gray-400">Customers requiring immediate intervention</p>
                            </div>

                            <div class="space-y-4 max-h-[700px] overflow-y-auto pr-2">
                                <template x-for="(customer, index) in priorityQueue.slice(0, 10)" :key="customer.id">
                                    <div class="at-risk-customer-card" :class="customer.priority">
                                        <!-- Header Row -->
                                        <div class="flex items-start justify-between mb-3">
                                            <div class="flex items-center gap-3 flex-1">
                                                <!-- Rank Badge -->
                                                <div class="rank-badge" :class="index < 3 ? 'top-3' : ''">
                                                    <span class="font-bold" x-text="'#' + (index + 1)"></span>
                                                </div>
                                                
                                                <!-- Customer Info -->
                                                <div class="flex-1">
                                                    <div class="flex items-center gap-2 mb-1">
                                                        <h3 class="font-bold text-white text-base" x-text="customer.name"></h3>
                                                        <span class="text-xs text-gray-500" x-text="'(' + customer.id + ')'"></span>
                                                    </div>
                                                    
                                                    <!-- Quick Info Line -->
                                                    <div class="flex items-center gap-2 text-xs text-gray-400 flex-wrap">
                                                        <span class="inline-flex items-center gap-1">
                                                            <i class="fas fa-tag text-purple-400"></i>
                                                            <span x-text="customer.segment"></span>
                                                        </span>
                                                        <span class="text-gray-600">|</span>
                                                        <span class="inline-flex items-center gap-1">
                                                            <i class="fas fa-shopping-bag text-blue-400"></i>
                                                            <span x-text="customer.category || 'General'"></span>
                                                        </span>
                                                        <span class="text-gray-600">|</span>
                                                        <span class="inline-flex items-center gap-1 text-success">
                                                            <i class="fas fa-dollar-sign"></i>
                                                            <span x-text="'LTV: $' + customer.ltv.toLocaleString()"></span>
                                                        </span>
                                                        <span class="text-gray-600">|</span>
                                                        <span class="inline-flex items-center gap-1 text-orange-400">
                                                            <i class="fas fa-language"></i>
                                                            <span x-text="customer.language || 'English'"></span>
                                                        </span>
                                                    </div>
                                                </div>
                                            </div>
                                            
                                            <!-- Risk Score -->
                                            <div class="text-right ml-3">
                                                <div class="text-xs text-gray-400 mb-1">Risk Score</div>
                                                <div class="text-2xl font-bold" :class="customer.churnRisk >= 80 ? 'text-red-400' : 'text-orange-400'" x-text="customer.churnRisk + '%'"></div>
                                            </div>
                                        </div>
                                        
                                        <!-- Escalation Status (if applicable) -->
                                        <div x-show="customer.escalated" class="mt-3 pt-3 border-t border-red-500/30 flex items-center gap-2 text-xs">
                                            <span class="inline-flex items-center gap-1 text-red-400 font-semibold">
                                                <i class="fas fa-exclamation-circle"></i>
                                                ð¨ ESCALATED
                                            </span>
                                            <span class="text-gray-400">|</span>
                                            <span class="text-gray-400">
                                                Assigned to: <span class="text-blue-400 font-medium">Senior Agent</span>
                                            </span>
                                        </div>
                                    </div>
                                </template>

                                <!-- Loading State -->
                                <template x-show="priorityQueue.length === 0">
                                    <div class="space-y-4">
                                        <div class="at-risk-customer-card loading h-28"></div>
                                        <div class="at-risk-customer-card loading h-28"></div>
                                        <div class="at-risk-customer-card loading h-28"></div>
                                    </div>
                                </template>
                            </div>
                        </div>

                        <!-- Risk Distribution Chart Section -->
                        <div class="glass-card p-6">
                            <div class="mb-6">
                                <h2 class="text-xl font-bold mb-2 flex items-center gap-2">
                                    <i class="fas fa-chart-pie text-primary"></i>
                                    Risk Distribution
                                </h2>
                                <p class="text-sm text-gray-400">Customer base segmented by churn risk levels</p>
                            </div>
                            
                            <!-- Chart -->
                            <div class="flex items-center justify-center mb-6">
                                <canvas id="riskChart" width="280" height="280"></canvas>
                            </div>
                            
                            <!-- Risk Level Cards -->
                            <div class="space-y-3">
                                <!-- Critical Risk -->
                                <div class="flex items-center justify-between p-4 rounded-lg bg-gradient-to-r from-red-500/10 to-transparent border border-red-500/20 hover:border-red-500/40 transition-all">
                                    <div class="flex items-center gap-3">
                                        <div class="w-12 h-12 rounded-xl bg-gradient-to-br from-red-500 to-red-600 flex items-center justify-center">
                                            <i class="fas fa-exclamation-circle text-white"></i>
                                        </div>
                                        <div>
                                            <div class="font-semibold text-red-400">Critical Risk</div>
                                            <div class="text-xs text-gray-400">Immediate attention required</div>
                                        </div>
                                    </div>
                                    <div class="text-right">
                                        <div class="text-2xl font-bold text-red-400" x-text="riskDistribution.critical.count">0</div>
                                        <div class="text-xs text-gray-500" x-text="riskDistribution.critical.percentage + '%'">0%</div>
                                    </div>
                                </div>
                                
                                <!-- High Risk -->
                                <div class="flex items-center justify-between p-4 rounded-lg bg-gradient-to-r from-orange-500/10 to-transparent border border-orange-500/20 hover:border-orange-500/40 transition-all">
                                    <div class="flex items-center gap-3">
                                        <div class="w-12 h-12 rounded-xl bg-gradient-to-br from-orange-500 to-orange-600 flex items-center justify-center">
                                            <i class="fas fa-exclamation-triangle text-white"></i>
                                        </div>
                                        <div>
                                            <div class="font-semibold text-orange-400">High Risk</div>
                                            <div class="text-xs text-gray-400">Proactive monitoring needed</div>
                                        </div>
                                    </div>
                                    <div class="text-right">
                                        <div class="text-2xl font-bold text-orange-400" x-text="riskDistribution.high.count">0</div>
                                        <div class="text-xs text-gray-500" x-text="riskDistribution.high.percentage + '%'">0%</div>
                                    </div>
                                </div>
                                
                                <!-- Medium Risk -->
                                <div class="flex items-center justify-between p-4 rounded-lg bg-gradient-to-r from-yellow-500/10 to-transparent border border-yellow-500/20 hover:border-yellow-500/40 transition-all">
                                    <div class="flex items-center gap-3">
                                        <div class="w-12 h-12 rounded-xl bg-gradient-to-br from-yellow-500 to-yellow-600 flex items-center justify-center">
                                            <i class="fas fa-exclamation text-white"></i>
                                        </div>
                                        <div>
                                            <div class="font-semibold text-yellow-400">Medium Risk</div>
                                            <div class="text-xs text-gray-400">Watch closely</div>
                                        </div>
                                    </div>
                                    <div class="text-right">
                                        <div class="text-2xl font-bold text-yellow-400" x-text="riskDistribution.medium.count">0</div>
                                        <div class="text-xs text-gray-500" x-text="riskDistribution.medium.percentage + '%'">0%</div>
                                    </div>
                                </div>
                                
                                <!-- Low Risk -->
                                <div class="flex items-center justify-between p-4 rounded-lg bg-gradient-to-r from-green-500/10 to-transparent border border-green-500/20 hover:border-green-500/40 transition-all">
                                    <div class="flex items-center gap-3">
                                        <div class="w-12 h-12 rounded-xl bg-gradient-to-br from-green-500 to-green-600 flex items-center justify-center">
                                            <i class="fas fa-check-circle text-white"></i>
                                        </div>
                                        <div>
                                            <div class="font-semibold text-green-400">Low Risk</div>
                                            <div class="text-xs text-gray-400">Healthy & stable</div>
                                        </div>
                                    </div>
                                    <div class="text-right">
                                        <div class="text-2xl font-bold text-green-400" x-text="riskDistribution.low.count">0</div>
                                        <div class="text-xs text-gray-500" x-text="riskDistribution.low.percentage + '%'">0%</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- PROACTIVE AI TAB -->
                <div x-show="activeTab === 'proactive'" class="space-y-8">
                    
                    <!-- 4-Agent Pipeline -->
                    <div class="glass-card p-8">
                        <h2 class="text-2xl font-bold mb-8 text-center flex items-center justify-center gap-3">
                            <i class="fas fa-brain text-primary"></i>
                            4-Agent AI Pipeline
                        </h2>
                        
                        <div class="agent-pipeline">
                            <!-- Bodha (Context Agent) -->
                            <div class="agent-card-new" :class="{ 
                                'active': currentAgent === 'bodha', 
                                'processing': currentAgent === 'bodha' && scanInProgress,
                                'completed': completedAgents.includes('bodha')
                            }">
                                <!-- Glow Background -->
                                <div class="agent-glow"></div>
                                
                                <!-- Agent Image -->
                                <div class="agent-image-container">
                                    <img src="assets/bodha.png" alt="Bodha" class="agent-image">
                                </div>
                                
                                <!-- Agent Name -->
                                <h3 class="agent-name">Bodha</h3>
                                <p class="agent-role">Context Agent</p>
                            </div>

                            <!-- Dhyana (Pattern Agent) -->
                            <div class="agent-card-new" :class="{ 
                                'active': currentAgent === 'dhyana', 
                                'processing': currentAgent === 'dhyana' && scanInProgress,
                                'completed': completedAgents.includes('dhyana')
                            }">
                                <!-- Glow Background -->
                                <div class="agent-glow"></div>
                                
                                <!-- Agent Image -->
                                <div class="agent-image-container">
                                    <img src="assets/Dhyana.png" alt="Dhyana" class="agent-image">
                                </div>
                                
                                <!-- Agent Name -->
                                <h3 class="agent-name">Dhyana</h3>
                                <p class="agent-role">Pattern Agent</p>
                            </div>

                            <!-- Niti (Decision Agent) -->
                            <div class="agent-card-new" :class="{ 
                                'active': currentAgent === 'niti', 
                                'processing': currentAgent === 'niti' && scanInProgress,
                                'completed': completedAgents.includes('niti')
                            }">
                                <!-- Glow Background -->
                                <div class="agent-glow"></div>
                                
                                <!-- Agent Image -->
                                <div class="agent-image-container">
                                    <img src="assets/niti.png" alt="Niti" class="agent-image">
                                </div>
                                
                                <!-- Agent Name -->
                                <h3 class="agent-name">Niti</h3>
                                <p class="agent-role">Decision Agent</p>
                            </div>

                            <!-- Karuna (Empathy Agent) -->
                            <div class="agent-card-new" :class="{ 
                                'active': currentAgent === 'karuna', 
                                'processing': currentAgent === 'karuna' && scanInProgress,
                                'completed': completedAgents.includes('karuna')
                            }">
                                <!-- Glow Background -->
                                <div class="agent-glow"></div>
                                
                                <!-- Agent Image -->
                                <div class="agent-image-container">
                                    <img src="assets/karuna.png" alt="Karuna" class="agent-image">
                                </div>
                                
                                <!-- Agent Name -->
                                <h3 class="agent-name">Karuna</h3>
                                <p class="agent-role">Empathy Agent</p>
                            </div>
                        </div>
                        
                        <div x-show="currentCustomer" class="mt-8 p-6 rounded-lg glass-card">
                            <h4 class="font-bold mb-4">Currently Processing:</h4>
                            <div class="flex items-center gap-4">
                                <div class="w-12 h-12 rounded-full bg-gradient-to-br from-primary to-secondary flex items-center justify-center">
                                    <i class="fas fa-user text-white"></i>
                                </div>
                                <div>
                                    <div class="font-medium" x-text="currentCustomer?.name">-</div>
                                    <div class="text-sm text-gray-400" x-text="'Churn Risk: ' + (currentCustomer?.churnRisk || 0) + '%'">-</div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- AI Interventions Results -->
                    <div class="glass-card p-6">
                        <h2 class="text-xl font-bold mb-6 flex items-center gap-2">
                            <i class="fas fa-magic text-purple-400"></i>
                            AI-Generated Interventions
                        </h2>
                        
                        <div class="space-y-4">
                            <template x-for="intervention in recentInterventions.slice(0, 5)" :key="intervention.id">
                                <div class="p-6 rounded-lg glass-card">
                                    <div class="flex items-start justify-between mb-4">
                                        <div>
                                            <h3 class="font-semibold" x-text="intervention.customerName"></h3>
                                            <p class="text-sm text-gray-400" x-text="'Risk: ' + intervention.churnRisk + '% | Action: ' + intervention.action"></p>
                                        </div>
                                        <div class="flex gap-2">
                                            <!-- Status Badge -->
                                            <span class="badge" 
                                                  :class="intervention.status === 'sent' ? 'bg-green-500/20 text-green-300 border-green-500/30' : 'bg-orange-500/20 text-orange-300 border-orange-500/30'"
                                                  x-text="intervention.status === 'sent' ? 'â Auto-Sent' : 'â  Escalated'">
                                            </span>
                                            <span class="badge" :class="'badge-' + intervention.priority" x-text="intervention.priority"></span>
                                        </div>
                                    </div>
                                    
                                    <div class="bg-gray-800 p-4 rounded-lg mb-4">
                                        <p class="text-sm italic" x-text="intervention.message"></p>
                                    </div>
                                    
                                    <div class="flex justify-between text-xs text-gray-400">
                                        <span x-text="'Language: ' + intervention.language"></span>
                                        <span x-text="new Date(intervention.timestamp).toLocaleString()"></span>
                                    </div>
                                </div>
                            </template>
                        </div>
                    </div>
                </div>

                <!-- AT-RISK CUSTOMERS TAB -->
                <div x-show="activeTab === 'atRisk'" class="space-y-6">

                    <!-- Filter Bar -->
                    <div class="glass-card p-4">
                        <div class="flex items-center gap-4 flex-wrap">
                            <div class="flex items-center gap-2">
                                <span class="text-sm text-gray-400">Risk Level:</span>
                                <button @click="atRiskFilter = 'all'" 
                                        :class="atRiskFilter === 'all' ? 'bg-primary text-white' : 'bg-gray-700 text-gray-300'"
                                        class="px-3 py-1.5 rounded-lg text-xs font-medium transition-all">
                                    All
                                </button>
                                <button @click="atRiskFilter = 'critical'" 
                                        :class="atRiskFilter === 'critical' ? 'bg-red-600 text-white' : 'bg-gray-700 text-gray-300'"
                                        class="px-3 py-1.5 rounded-lg text-xs font-medium transition-all">
                                    Critical
                                </button>
                                <button @click="atRiskFilter = 'high'" 
                                        :class="atRiskFilter === 'high' ? 'bg-orange-600 text-white' : 'bg-gray-700 text-gray-300'"
                                        class="px-3 py-1.5 rounded-lg text-xs font-medium transition-all">
                                    High
                                </button>
                                <button @click="atRiskFilter = 'medium'" 
                                        :class="atRiskFilter === 'medium' ? 'bg-yellow-600 text-white' : 'bg-gray-700 text-gray-300'"
                                        class="px-3 py-1.5 rounded-lg text-xs font-medium transition-all">
                                    Medium
                                </button>
                            </div>
                            <div class="h-6 w-px bg-gray-700"></div>
                            <div class="flex items-center gap-2">
                                <span class="text-sm text-gray-400">Status:</span>
                                <button @click="atRiskStatusFilter = 'all'" 
                                        :class="atRiskStatusFilter === 'all' ? 'bg-primary text-white' : 'bg-gray-700 text-gray-300'"
                                        class="px-3 py-1.5 rounded-lg text-xs font-medium transition-all">
                                    All
                                </button>
                                <button @click="atRiskStatusFilter = 'auto-sent'" 
                                        :class="atRiskStatusFilter === 'auto-sent' ? 'bg-green-600 text-white' : 'bg-gray-700 text-gray-300'"
                                        class="px-3 py-1.5 rounded-lg text-xs font-medium transition-all">
                                    Auto Sent (AI)
                                </button>
                                <button @click="atRiskStatusFilter = 'intervention-sent'" 
                                        :class="atRiskStatusFilter === 'intervention-sent' ? 'bg-blue-600 text-white' : 'bg-gray-700 text-gray-300'"
                                        class="px-3 py-1.5 rounded-lg text-xs font-medium transition-all">
                                    Intervention Sent
                                </button>
                                <button @click="atRiskStatusFilter = 'monitoring'" 
                                        :class="atRiskStatusFilter === 'monitoring' ? 'bg-purple-600 text-white' : 'bg-gray-700 text-gray-300'"
                                        class="px-3 py-1.5 rounded-lg text-xs font-medium transition-all">
                                    Monitoring
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Split Panel: Customer List + Details -->
                    <div class="grid grid-cols-12 gap-6">
                        
                        <!-- LEFT PANEL: At-Risk Customer List -->
                        <div class="col-span-5">
                            <div class="glass-card p-6">
                                <h3 class="text-lg font-bold mb-4 flex items-center gap-2">
                                    <i class="fas fa-list text-orange-400"></i>
                                    At-Risk Customers
                                    <span class="text-sm text-gray-400 font-normal ml-auto" x-text="`${filteredAtRiskCustomers.length} customers`"></span>
                                </h3>
                                
                                <div class="space-y-3 max-h-[calc(100vh-400px)] overflow-y-auto pr-2">
                                    <template x-for="customer in filteredAtRiskCustomers" :key="customer.id">
                                        <div @click="selectAtRiskCustomer(customer)" 
                                             :class="selectedAtRiskCustomer?.id === customer.id ? 'border-primary bg-primary/10' : 'border-gray-700 hover:border-gray-600'"
                                             class="p-4 rounded-lg border-2 cursor-pointer transition-all">
                                            
                                            <!-- Header -->
                                            <div class="flex items-start justify-between mb-2">
                                                <div class="flex-1">
                                                    <div class="flex items-center gap-2 mb-1">
                                                        <h4 class="font-bold text-white text-sm" x-text="customer.name"></h4>
                                                        <!-- Priority Tag -->
                                                        <span class="badge text-xs px-2.5 py-0.5 rounded-full font-bold uppercase"
                                                              :class="customer.churnRisk >= 80 ? 'bg-red-500/20 text-red-300 border border-red-500/30' : 
                                                                      customer.churnRisk >= 60 ? 'bg-orange-500/20 text-orange-300 border border-orange-500/30' : 
                                                                      'bg-yellow-500/20 text-yellow-300 border border-yellow-500/30'"
                                                              x-text="customer.churnRisk >= 80 ? 'CRITICAL' : customer.churnRisk >= 60 ? 'HIGH' : 'MEDIUM'"></span>
                                                    </div>
                                                    <div class="flex items-center gap-2 text-xs text-gray-400 mt-1">
                                                        <span x-text="customer.id"></span>
                                                        <span>â¢</span>
                                                        <span x-text="customer.segment"></span>
                                                        <span>â¢</span>
                                                        <span x-text="customer.language || 'English'"></span>
                                                    </div>
                                                </div>
                                                <div class="text-right">
                                                    <div class="text-lg font-bold" 
                                                         :class="customer.churnRisk >= 80 ? 'text-red-400' : customer.churnRisk >= 60 ? 'text-orange-400' : 'text-yellow-400'"
                                                         x-text="customer.churnRisk + '%'"></div>
                                                    <div class="text-xs text-gray-400">Risk</div>
                                                </div>
                                            </div>
                                            
                                            <!-- LTV & Status -->
                                            <div class="flex items-center justify-between text-xs mt-2 pt-2 border-t border-gray-700/50">
                                                <span class="text-green-400 font-medium">
                                                    <i class="fas fa-dollar-sign"></i>
                                                    LTV: $<span x-text="customer.ltv?.toLocaleString() || customer.lifetimeValue?.toLocaleString()"></span>
                                                </span>
                                                <!-- Status Badge -->
                                                <span class="px-2 py-0.5 rounded text-xs font-medium" :class="customer.statusClass" x-text="customer.statusText"></span>
                                            </div>
                                        </div>
                                    </template>
                                    
                                    <!-- Empty State -->
                                    <div x-show="filteredAtRiskCustomers.length === 0" class="text-center py-12">
                                        <i class="fas fa-inbox text-gray-600 text-4xl mb-3"></i>
                                        <p class="text-gray-400">No customers match the selected filters</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- RIGHT PANEL: Customer Details & Intervention -->
                        <div class="col-span-7">
                            <div class="glass-card p-6" x-show="selectedAtRiskCustomer">
                                
                                <!-- Customer Header -->
                                <div class="flex items-start justify-between mb-6 pb-6 border-b border-gray-700">
                                    <div class="flex items-center gap-4">
                                        <div class="w-16 h-16 rounded-full bg-gradient-to-br from-primary to-secondary flex items-center justify-center text-2xl font-bold text-white">
                                            <span x-text="selectedAtRiskCustomer?.name?.charAt(0)"></span>
                                        </div>
                                        <div>
                                            <div class="flex items-center gap-3 mb-1">
                                                <h2 class="text-2xl font-bold text-white" x-text="selectedAtRiskCustomer?.name"></h2>
                                                <!-- Priority Tag (Red Oval) -->
                                                <span class="badge text-xs px-3 py-1 rounded-full font-bold uppercase"
                                                      :class="selectedAtRiskCustomer?.churnRisk >= 80 ? 'bg-red-500/20 text-red-300 border-2 border-red-500' : 
                                                              selectedAtRiskCustomer?.churnRisk >= 60 ? 'bg-orange-500/20 text-orange-300 border-2 border-orange-500' : 
                                                              'bg-yellow-500/20 text-yellow-300 border-2 border-yellow-500'"
                                                      x-text="selectedAtRiskCustomer?.churnRisk >= 80 ? 'CRITICAL' : selectedAtRiskCustomer?.churnRisk >= 60 ? 'HIGH' : 'MEDIUM'"></span>
                                            </div>
                                            <div class="flex items-center gap-3 text-sm text-gray-400 mt-1">
                                                <span x-text="selectedAtRiskCustomer?.id"></span>
                                                <span>â¢</span>
                                                <span x-text="selectedAtRiskCustomer?.segment"></span>
                                                <span>â¢</span>
                                                <span class="text-green-400 font-medium">
                                                    $<span x-text="selectedAtRiskCustomer?.ltv?.toLocaleString() || selectedAtRiskCustomer?.lifetimeValue?.toLocaleString()"></span> LTV
                                                </span>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="text-right">
                                        <div class="text-4xl font-bold mb-1" 
                                             :class="selectedAtRiskCustomer?.churnRisk >= 80 ? 'text-red-400' : selectedAtRiskCustomer?.churnRisk >= 60 ? 'text-orange-400' : 'text-yellow-400'"
                                             x-text="selectedAtRiskCustomer?.churnRisk + '%'"></div>
                                        <div class="text-sm text-gray-400">Churn Risk</div>
                                    </div>
                                </div>
                                
                                <!-- Risk Indicators -->
                                <div class="mb-6">
                                    <h3 class="text-sm font-bold text-gray-300 mb-3 flex items-center gap-2">
                                        <i class="fas fa-chart-line text-red-400"></i>
                                        Risk Indicators
                                    </h3>
                                    <div class="grid grid-cols-2 gap-3">
                                        <div class="bg-gray-800/50 rounded-lg p-3 border border-gray-700/50">
                                            <div class="text-xs text-gray-400 mb-1">Health Score</div>
                                            <div class="text-xl font-bold" 
                                                 :class="selectedAtRiskCustomer?.healthScore >= 70 ? 'text-green-400' : selectedAtRiskCustomer?.healthScore >= 50 ? 'text-yellow-400' : 'text-red-400'"
                                                 x-text="selectedAtRiskCustomer?.healthScore || 'N/A'"></div>
                                        </div>
                                        <div class="bg-gray-800/50 rounded-lg p-3 border border-gray-700/50">
                                            <div class="text-xs text-gray-400 mb-1">Days Since Purchase</div>
                                            <div class="text-xl font-bold text-orange-400" x-text="selectedAtRiskCustomer?.daysSincePurchase || '60+'"></div>
                                        </div>
                                    </div>
                                    <div class="mt-3 space-y-2" x-show="selectedAtRiskCustomer?.reasons">
                                        <template x-for="reason in selectedAtRiskCustomer?.reasons?.slice(0, 3)" :key="reason">
                                            <div class="flex items-center gap-2 text-xs text-gray-400">
                                                <i class="fas fa-exclamation-circle text-orange-400"></i>
                                                <span x-text="reason"></span>
                                            </div>
                                        </template>
                                    </div>
                                </div>
                                
                                <!-- AI Recommendation (Only show if processed) -->
                                <div class="mb-6" x-show="selectedAtRiskCustomer?.status === 'sent' || selectedAtRiskCustomer?.status === 'escalated'">
                                    <h3 class="text-sm font-bold text-gray-300 mb-3 flex items-center gap-2">
                                        <i class="fas fa-robot text-pink-400"></i>
                                        AI Recommendation
                                    </h3>
                                    <div class="bg-gradient-to-br from-pink-500/10 to-rose-500/10 border border-pink-500/30 rounded-lg p-4">
                                        <p class="text-sm text-gray-300 leading-relaxed whitespace-pre-wrap" x-text="selectedAtRiskCustomer?.processedInfo?.intervention?.action || selectedAtRiskCustomer?.processedInfo?.intervention?.recommendation || 'Recommendation from AI agents'"></p>
                                    </div>
                                </div>

                                <!-- Action Taken by AI (Only show if escalated) -->
                                <div class="mb-6" x-show="selectedAtRiskCustomer?.status === 'escalated' && selectedAtRiskCustomer?.processedInfo?.intervention?.actionTaken">
                                    <h3 class="text-sm font-bold text-gray-300 mb-3 flex items-center gap-2">
                                        <i class="fas fa-check-circle text-green-400"></i>
                                        Action Taken by AI
                                    </h3>
                                    <div class="bg-gradient-to-br from-green-500/10 to-emerald-500/10 border border-green-500/30 rounded-lg p-4">
                                        <div class="flex items-start gap-3">
                                            <i class="fas fa-tag text-green-400 mt-1"></i>
                                            <div>
                                                <p class="text-sm font-medium text-green-300 mb-1">Automated Actions Applied</p>
                                                <p class="text-sm text-gray-300 leading-relaxed" x-text="selectedAtRiskCustomer?.processedInfo?.intervention?.actionTaken"></p>
                                                <div class="mt-2 text-xs text-gray-400">
                                                    <i class="fas fa-info-circle"></i>
                                                    System approved within policy limits - ready for human review
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- Intervention Message Section -->
                                <div class="mb-6">
                                    <h3 class="text-sm font-bold text-gray-300 mb-3 flex items-center gap-2">
                                        <i class="fas fa-paper-plane text-blue-400"></i>
                                        Intervention Message
                                    </h3>
                                    <div class="space-y-3">
                                        <!-- For SENT customers: Show uneditable message -->
                                        <div x-show="selectedAtRiskCustomer?.status === 'sent'">
                                            <label class="block text-xs text-gray-400 mb-1.5">AI-Generated Message (Sent)</label>
                                            <div class="w-full bg-gray-800/50 border border-gray-700 rounded-lg px-4 py-3 text-sm text-white max-h-64 overflow-y-auto">
                                                <p class="whitespace-pre-wrap" x-text="selectedAtRiskCustomer?.processedInfo?.intervention?.message || atRiskMessage || 'Message sent to customer'"></p>
                                            </div>
                                        </div>
                                        
                                        <!-- For ESCALATED customers: Show editable message -->
                                        <div x-show="selectedAtRiskCustomer?.status === 'escalated'">
                                            <label class="block text-xs text-gray-400 mb-1.5">AI-Generated Message (Editable - Review & Send)</label>
                                            <textarea x-model="atRiskMessage" 
                                                      rows="8"
                                                      class="w-full bg-gray-800/50 border border-gray-700 rounded-lg px-4 py-3 text-sm text-white focus:border-primary focus:outline-none resize-none"
                                                      placeholder="AI-generated message will appear here after processing..."></textarea>
                                        </div>
                                        
                                        <!-- For PENDING customers: Show disabled message -->
                                        <div x-show="selectedAtRiskCustomer?.status === 'pending'">
                                            <label class="block text-xs text-gray-400 mb-1.5">Message (AI will generate after processing)</label>
                                            <textarea x-model="atRiskMessage" 
                                                      rows="8"
                                                      disabled
                                                      class="w-full bg-gray-800/50 border border-gray-700 rounded-lg px-4 py-3 text-sm text-white focus:border-primary focus:outline-none resize-none opacity-50 cursor-not-allowed"
                                                      placeholder="Click 'Process Customers' to generate AI message..."></textarea>
                                        </div>
                                        
                                        <div class="flex items-center gap-2 text-xs text-gray-400">
                                            <i class="fas fa-language text-orange-400"></i>
                                            <span>Language: <span class="text-white font-medium" x-text="selectedAtRiskCustomer?.language || 'English'"></span></span>
                                            <span class="mx-2">|</span>
                                            <i class="fas fa-tag text-purple-400"></i>
                                            <span>Segment: <span class="text-white font-medium" x-text="selectedAtRiskCustomer?.segment"></span></span>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- Internal Notes (Show only for escalated customers) -->
                                <div x-show="selectedAtRiskCustomer?.status === 'escalated'" class="mb-6">
                                    <label class="block text-xs text-gray-400 mb-1.5">Internal Notes (Optional)</label>
                                    <textarea x-model="atRiskNotes" 
                                              rows="3"
                                              class="w-full bg-gray-800/50 border border-gray-700 rounded-lg px-4 py-3 text-sm text-white focus:border-primary focus:outline-none resize-none"
                                              placeholder="Add notes for future reference..."></textarea>
                                </div>
                                
                                <!-- View Journey Button (Only for sent/escalated customers) -->
                                <div class="mb-6" x-show="selectedAtRiskCustomer?.status === 'sent' || selectedAtRiskCustomer?.status === 'escalated'">
                                    <button @click="viewAgentJourney(selectedAtRiskCustomer)" 
                                            class="w-full px-6 py-3 rounded-lg bg-gradient-to-r from-purple-600 to-pink-600 hover:from-purple-700 hover:to-pink-700 text-white font-semibold transition-all flex items-center justify-center gap-2">
                                        <i class="fas fa-route"></i>
                                        View 4-Agent Processing Journey
                                    </button>
                                </div>
                                
                                <!-- Action Buttons (Show only for escalated customers needing human intervention) -->
                                <div x-show="selectedAtRiskCustomer?.status === 'escalated'" class="flex gap-3">
                                    <button @click="sendIntervention()" 
                                            class="flex-1 px-6 py-3 rounded-lg bg-gradient-to-r from-primary to-secondary hover:from-primary-dark hover:to-primary text-white font-semibold transition-all flex items-center justify-center gap-2">
                                        <i class="fas fa-paper-plane"></i>
                                        Send Intervention
                                    </button>
                                    <button @click="scheduleIntervention()" 
                                            class="px-6 py-3 rounded-lg bg-gray-700 hover:bg-gray-600 text-white font-semibold transition-all flex items-center justify-center gap-2">
                                        <i class="fas fa-clock"></i>
                                        Schedule
                                    </button>
                                </div>
                                
                                <!-- Pending State Message -->
                                <div x-show="selectedAtRiskCustomer?.status === 'pending'" class="bg-gray-800/50 border border-gray-700 rounded-lg p-6 text-center">
                                    <i class="fas fa-clock text-gray-500 text-3xl mb-3"></i>
                                    <h3 class="text-lg font-bold text-gray-400 mb-2">Awaiting Processing</h3>
                                    <p class="text-sm text-gray-500">Click "Process Customers" to run 4-agent analysis on this customer</p>
                                </div>
                            </div>
                            
                            <!-- Empty State -->
                            <div class="glass-card p-12 text-center" x-show="!selectedAtRiskCustomer">
                                <i class="fas fa-user-clock text-gray-600 text-5xl mb-4"></i>
                                <h3 class="text-xl font-bold text-gray-400 mb-2">Select a Customer</h3>
                                <p class="text-gray-500">Choose an at-risk customer from the list to view details and trigger intervention</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 4-AGENT JOURNEY MODAL -->
                <div x-show="showAgentJourneyModal" 
                     x-cloak
                     class="fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/80 backdrop-blur-sm"
                     @click.self="showAgentJourneyModal = false">
                    <div class="bg-gray-900 rounded-xl border border-gray-700 shadow-2xl max-w-4xl w-full max-h-[90vh] overflow-y-auto"
                         @click.stop>
                        
                        <!-- Modal Header -->
                        <div class="sticky top-0 bg-gray-900 border-b border-gray-700 px-6 py-4 flex items-center justify-between z-10">
                            <div>
                                <h2 class="text-2xl font-bold text-white flex items-center gap-3">
                                    <i class="fas fa-route text-primary"></i>
                                    4-Agent Processing Journey
                                </h2>
                                <p class="text-sm text-gray-400 mt-1" x-text="'Customer: ' + (agentJourneyData?.customerName || '')"></p>
                            </div>
                            <button @click="showAgentJourneyModal = false" 
                                    class="text-gray-400 hover:text-white transition-colors">
                                <i class="fas fa-times text-xl"></i>
                            </button>
                        </div>

                        <!-- Modal Body -->
                        <div class="p-6 space-y-6">
                            
                            <!-- Status Badge -->
                            <div class="flex items-center justify-between bg-gray-800/50 rounded-lg p-4 border border-gray-700">
                                <div>
                                    <div class="text-xs text-gray-400 mb-1">Processing Status</div>
                                    <div class="text-2xl font-bold">
                                        <span class="badge text-base px-4 py-2"
                                              :class="agentJourneyData?.status === 'sent' ? 'bg-green-500/20 text-green-300' : 
                                                      agentJourneyData?.status === 'escalated' ? 'bg-orange-500/20 text-orange-300' : 
                                                      'bg-gray-500/20 text-gray-300'"
                                              x-text="agentJourneyData?.status === 'sent' ? 'AUTO-SENT' : 
                                                      agentJourneyData?.status === 'escalated' ? 'INTERVENTION SENT' : 
                                                      'PENDING REVIEW'">
                                        </span>
                                    </div>
                                </div>
                                <div class="text-right">
                                    <div class="text-xs text-gray-400 mb-1">Channels</div>
                                    <div class="flex gap-2">
                                        <template x-for="channel in (agentJourneyData?.intervention?.channels || [])" :key="channel">
                                            <span class="badge bg-blue-500/20 text-blue-300 text-xs" x-text="channel"></span>
                                        </template>
                                    </div>
                                </div>
                            </div>

                            <!-- Agent 1: Bodha (Context) -->
                            <div class="bg-gradient-to-br from-purple-500/10 to-purple-600/10 border border-purple-500/30 rounded-lg p-5">
                                <div class="flex items-center gap-3 mb-4">
                                    <div class="w-12 h-12 rounded-full bg-purple-500/20 flex items-center justify-center">
                                        <i class="fas fa-brain text-purple-400 text-xl"></i>
                                    </div>
                                    <div>
                                        <h3 class="text-lg font-bold text-white">Bodha (à¤¬à¥à¤§) - Context Agent</h3>
                                        <p class="text-xs text-gray-400">Analyzing customer sentiment & urgency</p>
                                    </div>
                                </div>
                                <div class="space-y-2 text-sm">
                                    <div class="flex items-start gap-2">
                                        <i class="fas fa-smile text-purple-400 mt-1"></i>
                                        <div>
                                            <span class="text-gray-400">Sentiment:</span>
                                            <span class="text-white font-medium ml-2" x-text="agentJourneyData?.intervention?.agents?.bodha?.sentiment || 'N/A'"></span>
                                        </div>
                                    </div>
                                    <div class="flex items-start gap-2">
                                        <i class="fas fa-chart-line text-purple-400 mt-1"></i>
                                        <div>
                                            <span class="text-gray-400">Risk Analysis:</span>
                                            <span class="text-white font-medium ml-2" x-text="agentJourneyData?.intervention?.agents?.bodha?.analysis || 'Detected declining engagement and purchase frequency'"></span>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Agent 2: Dhyana (Pattern) -->
                            <div class="bg-gradient-to-br from-blue-500/10 to-blue-600/10 border border-blue-500/30 rounded-lg p-5">
                                <div class="flex items-center gap-3 mb-4">
                                    <div class="w-12 h-12 rounded-full bg-blue-500/20 flex items-center justify-center">
                                        <i class="fas fa-project-diagram text-blue-400 text-xl"></i>
                                    </div>
                                    <div>
                                        <h3 class="text-lg font-bold text-white">Dhyana (à¤§à¥à¤¯à¤¾à¤¨) - Pattern Agent</h3>
                                        <p class="text-xs text-gray-400">Identifying behavioral patterns</p>
                                    </div>
                                </div>
                                <div class="space-y-2 text-sm">
                                    <div class="flex items-start gap-2">
                                        <i class="fas fa-chart-bar text-blue-400 mt-1"></i>
                                        <div>
                                            <span class="text-gray-400">Patterns Found:</span>
                                            <span class="text-white font-medium ml-2" x-text="agentJourneyData?.intervention?.agents?.dhyana?.patterns || 'Decreased purchase frequency, higher support ticket volume'"></span>
                                        </div>
                                    </div>
                                    <div class="flex items-start gap-2">
                                        <i class="fas fa-users text-blue-400 mt-1"></i>
                                        <div>
                                            <span class="text-gray-400">Similar Cases:</span>
                                            <span class="text-white font-medium ml-2" x-text="agentJourneyData?.intervention?.agents?.dhyana?.similar_cases || '15 similar customers identified'"></span>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Agent 3: Niti (Decision) -->
                            <div class="bg-gradient-to-br from-orange-500/10 to-orange-600/10 border border-orange-500/30 rounded-lg p-5">
                                <div class="flex items-center gap-3 mb-4">
                                    <div class="w-12 h-12 rounded-full bg-orange-500/20 flex items-center justify-center">
                                        <i class="fas fa-balance-scale text-orange-400 text-xl"></i>
                                    </div>
                                    <div>
                                        <h3 class="text-lg font-bold text-white">Niti (à¤¨à¥à¤¤à¤¿) - Decision Agent</h3>
                                        <p class="text-xs text-gray-400">Determining optimal action & escalation</p>
                                    </div>
                                </div>
                                <div class="space-y-2 text-sm">
                                    <div class="flex items-start gap-2">
                                        <i class="fas fa-lightbulb text-orange-400 mt-1"></i>
                                        <div>
                                            <span class="text-gray-400">Recommended Action:</span>
                                            <span class="text-white font-medium ml-2" x-text="agentJourneyData?.intervention?.action || 'Send personalized re-engagement offer'"></span>
                                        </div>
                                    </div>
                                    <div class="flex items-center gap-2">
                                        <i class="fas fa-flag text-orange-400"></i>
                                        <span class="text-gray-400">Priority:</span>
                                        <span class="badge text-xs"
                                              :class="agentJourneyData?.intervention?.priority === 'critical' ? 'badge-critical' : 
                                                      agentJourneyData?.intervention?.priority === 'high' ? 'badge-high' : 'badge-medium'"
                                              x-text="(agentJourneyData?.intervention?.priority || 'medium').toUpperCase()"></span>
                                    </div>
                                    <div class="flex items-start gap-2">
                                        <i class="fas fa-user-shield text-orange-400 mt-1"></i>
                                        <div>
                                            <span class="text-gray-400">Escalation Decision:</span>
                                            <span class="text-white font-medium ml-2" x-text="agentJourneyData?.intervention?.escalated ? 'YES - Requires human review (VIP/High-LTV/Low-CSAT)' : 'NO - Handled by AI automatically'"></span>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Agent 4: Karuna (Empathy) -->
                            <div class="bg-gradient-to-br from-pink-500/10 to-pink-600/10 border border-pink-500/30 rounded-lg p-5">
                                <div class="flex items-center gap-3 mb-4">
                                    <div class="w-12 h-12 rounded-full bg-pink-500/20 flex items-center justify-center">
                                        <i class="fas fa-heart text-pink-400 text-xl"></i>
                                    </div>
                                    <div>
                                        <h3 class="text-lg font-bold text-white">Karuna (à¤à¤°à¥à¤£à¤¾) - Empathy Agent</h3>
                                        <p class="text-xs text-gray-400">Crafting culturally-aware message</p>
                                    </div>
                                </div>
                                <div class="space-y-3 text-sm">
                                    <div class="flex items-start gap-2">
                                        <i class="fas fa-language text-pink-400 mt-1"></i>
                                        <div>
                                            <span class="text-gray-400">Language:</span>
                                            <span class="text-white font-medium ml-2" x-text="agentJourneyData?.intervention?.language || 'en'"></span>
                                        </div>
                                    </div>
                                    <div class="flex items-start gap-2">
                                        <i class="fas fa-smile-beam text-pink-400 mt-1"></i>
                                        <div>
                                            <span class="text-gray-400">Tone:</span>
                                            <span class="text-white font-medium ml-2" x-text="agentJourneyData?.intervention?.agents?.karuna?.tone || 'Warm and personalized'"></span>
                                        </div>
                                    </div>
                                    <div class="bg-gray-800/50 rounded-lg p-4 mt-3">
                                        <div class="text-xs text-gray-400 mb-2">Generated Message:</div>
                                        <p class="text-white leading-relaxed" x-text="agentJourneyData?.intervention?.message || 'Message generated by Karuna agent...'"></p>
                                    </div>
                                </div>
                            </div>

                            <!-- Timestamp -->
                            <div class="text-center text-xs text-gray-500 pt-4 border-t border-gray-700">
                                Processed on <span x-text="agentJourneyData?.intervention?.timestamp ? new Date(agentJourneyData.intervention.timestamp).toLocaleString() : 'N/A'"></span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- ESCALATION QUEUE TAB -->
                <div x-show="activeTab === 'reactive'" class="space-y-6">

                    <!-- Main Escalation Interface: Split Panel -->
                    <div class="grid grid-cols-12 gap-6">
                        
                        <!-- LEFT PANEL: Escalation List -->
                        <div class="col-span-5">
                            <div class="glass-card p-6">
                                <div class="flex items-center justify-between mb-6">
                                    <h2 class="text-xl font-bold flex items-center gap-2">
                                        <i class="fas fa-exclamation-triangle text-orange-400"></i>
                                        Active Escalations
                                        <span class="badge badge-critical ml-2" x-text="escalations.filter(e => e.status === 'open').length">0</span>
                                    </h2>
                                    
                                    <!-- Filter Buttons -->
                                    <div class="flex gap-2">
                                        <button @click="escalationFilter = 'all'" 
                                                :class="escalationFilter === 'all' ? 'bg-primary' : 'bg-gray-700'"
                                                class="px-3 py-1 rounded text-xs font-medium">
                                            All
                                        </button>
                                        <button @click="escalationFilter = 'critical'" 
                                                :class="escalationFilter === 'critical' ? 'bg-red-500' : 'bg-gray-700'"
                                                class="px-3 py-1 rounded text-xs font-medium">
                                            Critical
                                        </button>
                                        <button @click="escalationFilter = 'high'" 
                                                :class="escalationFilter === 'high' ? 'bg-orange-500' : 'bg-gray-700'"
                                                class="px-3 py-1 rounded text-xs font-medium">
                                            High
                                        </button>
                                    </div>
                                </div>

                                <!-- Escalation Cards List -->
                                <div class="space-y-3 max-h-[600px] overflow-y-auto">
                                    <template x-for="escalation in filteredEscalations" :key="escalation.id">
                                        <div @click="selectEscalation(escalation)"
                                             :class="selectedEscalation?.id === escalation.id ? 'border-primary bg-primary/10' : 'border-gray-700 hover:border-gray-600'"
                                             class="border-2 rounded-lg p-4 cursor-pointer transition-all">
                                            
                                            <!-- Header -->
                                            <div class="flex items-start justify-between mb-3">
                                                <div>
                                                    <div class="font-bold text-sm" x-text="'#ESC' + String(escalation.id).padStart(3, '0')"></div>
                                                    <div class="text-base font-semibold mt-1" x-text="escalation.customerName"></div>
                                                </div>
                                                <span :class="{
                                                    'badge-critical': escalation.priority === 'critical',
                                                    'badge-high': escalation.priority === 'high',
                                                    'badge-medium': escalation.priority === 'medium'
                                                }" class="badge text-xs" x-text="escalation.priority.toUpperCase()"></span>
                                            </div>

                                            <!-- Quick Info -->
                                            <div class="flex items-center gap-3 text-xs text-gray-400 mb-2">
                                                <span x-text="escalation.segment"></span>
                                                <span>â¢</span>
                                                <span x-text="'Risk: ' + escalation.churnRisk + '%'"></span>
                                                <span>â¢</span>
                                                <span x-text="escalation.language"></span>
                                            </div>

                                            <!-- Trigger Info -->
                                            <div class="text-xs text-gray-500 mb-2" x-text="'Triggers: ' + escalation.triggers"></div>

                                            <!-- Time Info -->
                                            <div class="flex items-center justify-between text-xs">
                                                <span class="text-gray-500" x-text="'Created: ' + escalation.createdTime"></span>
                                                <span class="text-orange-400 font-medium" x-text="'SLA: ' + escalation.slaRemaining"></span>
                                            </div>
                                        </div>
                                    </template>

                                    <!-- Empty State -->
                                    <div x-show="filteredEscalations.length === 0" class="text-center py-12">
                                        <i class="fas fa-check-circle text-green-400 text-4xl mb-3"></i>
                                        <div class="text-gray-400">No escalations found</div>
                                    </div>
                                </div>

                            </div>
                        </div>

                        <!-- RIGHT PANEL: Escalation Detail -->
                        <div class="col-span-7">
                            <div class="glass-card p-6">
                                <!-- No Selection State -->
                                <div x-show="!selectedEscalation" class="text-center py-20">
                                    <i class="fas fa-hand-pointer text-gray-600 text-6xl mb-4"></i>
                                    <h3 class="text-xl font-bold text-gray-400 mb-2">Select an Escalation</h3>
                                    <p class="text-gray-500">Choose an escalation from the list to view details</p>
                                </div>

                                <!-- Selected Escalation Detail -->
                                <div x-show="selectedEscalation" class="space-y-6">
                                    
                                    <!-- Header with Actions -->
                                    <div class="flex items-start justify-between pb-4 border-b border-gray-700">
                                        <div>
                                            <div class="text-sm text-gray-400 mb-1" x-text="'#ESC' + String(selectedEscalation?.id || 0).padStart(3, '0')"></div>
                                            <h2 class="text-2xl font-bold mb-2" x-text="selectedEscalation?.customerName"></h2>
                                            <div class="flex items-center gap-4 text-sm text-gray-400">
                                                <span x-text="selectedEscalation?.segment"></span>
                                                <span>â¢</span>
                                                <span x-text="'LTV: â¹' + selectedEscalation?.ltv?.toLocaleString()"></span>
                                                <span>â¢</span>
                                                <span x-text="'Risk: ' + selectedEscalation?.churnRisk + '%'"></span>
                                                <span>â¢</span>
                                                <span x-text="selectedEscalation?.language"></span>
                                            </div>
                                        </div>
                                        <span :class="{
                                            'badge-critical': selectedEscalation?.priority === 'critical',
                                            'badge-high': selectedEscalation?.priority === 'high',
                                            'badge-medium': selectedEscalation?.priority === 'medium'
                                        }" class="badge" x-text="selectedEscalation?.priority?.toUpperCase()"></span>
                                    </div>

                                    <!-- Trigger Information -->
                                    <div>
                                        <h3 class="font-bold mb-2 flex items-center gap-2">
                                            <i class="fas fa-flag text-red-400"></i>
                                            Escalation Triggers
                                        </h3>
                                        <div class="glass-card p-4">
                                            <p class="text-sm text-gray-300" x-text="selectedEscalation?.triggers"></p>
                                            <div class="mt-2 flex gap-2 text-xs">
                                                <span class="text-gray-500" x-text="'Created: ' + selectedEscalation?.createdTime"></span>
                                                <span>â¢</span>
                                                <span class="text-orange-400" x-text="'SLA: ' + selectedEscalation?.slaRemaining"></span>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- AI Recommendation -->
                                    <div>
                                        <h3 class="font-bold mb-2 flex items-center gap-2">
                                            <i class="fas fa-robot text-purple-400"></i>
                                            AI Recommendation
                                        </h3>
                                        <div class="glass-card p-4">
                                            <p class="text-sm text-gray-300" x-text="selectedEscalation?.aiRecommendation"></p>
                                        </div>
                                    </div>

                                    <!-- Action Taken by AI -->
                                    <div>
                                        <h3 class="font-bold mb-2 flex items-center gap-2">
                                            <i class="fas fa-check-circle text-green-400"></i>
                                            Action Taken by AI
                                        </h3>
                                        <div class="glass-card p-4 bg-green-500/5 border border-green-500/20">
                                            <div class="flex items-start gap-3">
                                                <i class="fas fa-tag text-green-400 mt-1"></i>
                                                <div>
                                                    <p class="text-sm font-medium text-green-300 mb-1">Discount Applied</p>
                                                    <p class="text-sm text-gray-300" x-text="selectedEscalation?.actionTaken || 'Applied 10.0% discount to customer account'"></p>
                                                    <div class="mt-2 text-xs text-gray-400">
                                                        <i class="fas fa-info-circle"></i>
                                                        Automated retention incentive approved within policy limits
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- AI-Generated Message (Editable) -->
                                    <div>
                                        <h3 class="font-bold mb-2 flex items-center gap-2">
                                            <i class="fas fa-comment-dots text-cyan-400"></i>
                                            Customer Message
                                            <span class="text-xs text-gray-500" x-text="'(AI-generated in ' + selectedEscalation?.language + ')'"></span>
                                        </h3>
                                        <div class="glass-card p-4">
                                            <div class="text-xs text-gray-400 mb-2 italic">
                                                <i class="fas fa-info-circle"></i> Edit the message below if needed before sending
                                            </div>
                                            <textarea x-model="escalationMessage" 
                                                      class="w-full min-h-[320px] bg-black/20 text-gray-300 rounded-lg p-3 border border-gray-700 focus:border-primary focus:outline-none resize-y"
                                                      placeholder="AI-generated message will appear here..."></textarea>
                                        </div>
                                    </div>

                                    <!-- Internal Notes (Optional) -->
                                    <div>
                                        <h3 class="font-bold mb-2 flex items-center gap-2">
                                            <i class="fas fa-sticky-note text-yellow-400"></i>
                                            Internal Notes
                                            <span class="text-xs text-gray-500">(Optional - for case documentation)</span>
                                        </h3>
                                        <div class="glass-card p-4">
                                            <textarea x-model="escalationNotes" 
                                                      class="w-full h-24 bg-black/20 text-gray-300 rounded-lg p-3 border border-gray-700 focus:border-primary focus:outline-none resize-none"
                                                      placeholder="Add any internal notes about this case (e.g., customer's specific concerns, follow-up actions needed, etc.)"></textarea>
                                        </div>
                                    </div>

                                    <!-- Action Buttons -->
                                    <div>
                                        <h3 class="font-bold mb-2 flex items-center gap-2">
                                            <i class="fas fa-bolt text-green-400"></i>
                                            Take Action
                                        </h3>
                                        <div class="glass-card p-4">
                                            <div class="flex gap-3">
                                                <button @click="sendMessage()" class="flex-1 btn btn-primary flex items-center justify-center gap-2">
                                                    <i class="fas fa-paper-plane"></i>
                                                    Send Message
                                                </button>
                                                <button @click="callCustomer()" class="flex-1 btn btn-secondary flex items-center justify-center gap-2">
                                                    <i class="fas fa-phone"></i>
                                                    Call Customer
                                                </button>
                                                <button @click="saveDraft()" class="flex-1 btn btn-secondary flex items-center justify-center gap-2">
                                                    <i class="fas fa-save"></i>
                                                    Save Draft
                                                </button>
                                            </div>
                                        </div>
                                    </div>

                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- HISTORY TAB -->
                <div x-show="activeTab === 'history'" class="space-y-8">
                    <div class="glass-card p-6">
                        <h2 class="text-xl font-bold mb-6 flex items-center gap-2">
                            <i class="fas fa-history text-info"></i>
                            Intervention History
                        </h2>
                        
                        <div class="space-y-4">
                            <template x-for="intervention in recentInterventions" :key="intervention.id">
                                <div class="p-6 rounded-lg glass-card border-l-4" 
                                     :class="intervention.type === 'escalation-resolved' ? 'border-blue-500' : 'border-green-500'">
                                    <div class="flex items-start justify-between mb-4">
                                        <div class="flex-1">
                                            <div class="flex items-center gap-3 mb-2">
                                                <i :class="intervention.type === 'escalation-resolved' ? 'fas fa-user-shield text-blue-400' : 'fas fa-robot text-green-400'" 
                                                   class="text-lg"></i>
                                                <h3 class="font-bold text-lg" x-text="intervention.customerName"></h3>
                                                <span class="text-xs text-gray-500" x-text="intervention.customerId"></span>
                                            </div>
                                            <p class="text-sm font-medium mb-1" 
                                               :class="intervention.type === 'escalation-resolved' ? 'text-blue-400' : 'text-green-400'" 
                                               x-text="intervention.action"></p>
                                            <div class="flex items-center gap-3 text-xs text-gray-400">
                                                <span>
                                                    <i class="fas fa-calendar mr-1"></i>
                                                    <span x-text="new Date(intervention.timestamp).toLocaleString()"></span>
                                                </span>
                                                <span x-show="intervention.language">
                                                    <i class="fas fa-language mr-1"></i>
                                                    <span x-text="intervention.language"></span>
                                                </span>
                                            </div>
                                        </div>
                                        <div class="text-right">
                                            <span class="badge text-sm px-3 py-1.5" 
                                                  :class="'badge-' + intervention.priority" 
                                                  x-text="intervention.priority?.toUpperCase()"></span>
                                        </div>
                                    </div>
                                    
                                    <!-- Show message for escalation-resolved -->
                                    <div x-show="intervention.type === 'escalation-resolved'" class="mt-4 pt-4 border-t border-gray-700">
                                        <label class="block text-xs text-gray-400 mb-2">Message Sent:</label>
                                        <div class="bg-gray-800/50 rounded-lg p-4 text-sm text-gray-300 mb-3" x-text="intervention.message"></div>
                                        <div x-show="intervention.notes">
                                            <label class="block text-xs text-gray-400 mb-2">Notes:</label>
                                            <div class="bg-gray-800/50 rounded-lg p-3 text-sm text-gray-400 italic" x-text="intervention.notes"></div>
                                        </div>
                                    </div>
                                </div>
                            </template>
                            
                            <!-- Empty State -->
                            <div x-show="recentInterventions.length === 0" class="text-center py-12">
                                <i class="fas fa-inbox text-gray-600 text-4xl mb-3"></i>
                                <p class="text-gray-400">No intervention history yet</p>
                                <p class="text-sm text-gray-500 mt-2">Resolved escalations and sent interventions will appear here</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Add floating particles
        function createParticles() {
            const particles = document.querySelector('.particles');
            const particleCount = 50;
            
            for (let i = 0; i < particleCount; i++) {
                const particle = document.createElement('div');
                particle.className = 'particle';
                particle.style.left = Math.random() * 100 + '%';
                particle.style.animationDelay = Math.random() * 15 + 's';
                particle.style.animationDuration = (15 + Math.random() * 10) + 's';
                particles.appendChild(particle);
            }
        }

        function revolutionaryDashboard() {
            return {
                // State
                activeTab: 'overview',
                sidebarCollapsed: false,
                scanInProgress: false,
                currentAgent: null,
                currentCustomer: null,
                socket: null,
                
                // Agent tracking for sequential glow (one customer at a time)
                completedAgents: [],  // Track which agents completed for current customer
                currentCustomerProcessing: null,  // Track which customer is being processed
                
                // Data
                stats: {
                    totalCustomers: 0,
                    atRisk: 0,
                    escalated: 2,  // Fixed to 2 escalations
                    resolvedToday: 0,
                    aiInterventions: 3,  // Fixed to 3 for Agents tab badge
                    avgHealthScore: 0
                },
                
                riskDistribution: {
                    critical: { count: 0, percentage: 0, color: '#ef4444' },
                    high: { count: 0, percentage: 0, color: '#f59e0b' },
                    medium: { count: 0, percentage: 0, color: '#eab308' },
                    low: { count: 0, percentage: 0, color: '#10b981' }
                },
                
                priorityQueue: [],
                recentEvents: [],
                recentInterventions: [],
                riskChart: null,
                
                // Escalation Queue Data
                escalations: [],
                selectedEscalation: null,
                escalationFilter: 'all',
                escalationMessage: '',
                escalationNotes: '',
                
                // At-Risk Customers Data
                atRiskCustomers: [],
                selectedAtRiskCustomer: null,
                atRiskFilter: 'all',
                atRiskMessage: '',
                atRiskNotes: '',
                
                // Agent Journey Modal
                showAgentJourneyModal: false,
                agentJourneyData: null,
                selectedAtRiskCustomer: null,
                atRiskFilter: 'all',
                atRiskStatusFilter: 'all',
                atRiskMessage: '',
                atRiskNotes: '',
                
                // Full Details Modal
                showFullDetailsModal: false,
                fullDetailsData: null,
                fullDetailsLoading: false,
                
                // Toast Notifications
                toasts: [],

                // Initialize
                async init() {
                    console.log('ð Initializing Revolutionary ProCX Dashboard...');
                    
                    // Clear session history - start fresh
                    this.recentInterventions = [];
                    this.recentEvents = [];
                    
                    // Clear backend session on page load (so all customers start as PENDING)
                    try {
                        await fetch('/api/scan/clear-session', { method: 'POST' });
                        console.log('ð§¹ Backend session cleared - all customers reset to PENDING');
                    } catch (error) {
                        console.log('â ï¸ Could not clear backend session (backend may be offline)');
                    }
                    
                    // Dashboard ready - no toast needed
                    
                    // Create particles
                    createParticles();
                    
                    // Connect WebSocket
                    this.connectWebSocket();
                    
                    // Make toast function globally accessible for testing
                    window.testToast = () => this.testToast();
                    window.showToast = (type, title, message) => this.showToast(type, title, message);
                    
                    // Load initial data
                    await this.loadDashboardData();
                    
                    // Load escalations
                    await this.loadEscalations();
                    
                    // Load at-risk customers
                    await this.loadAtRiskCustomers();
                    
                    // Initialize risk chart
                    this.$nextTick(() => {
                        this.initRiskChart();
                    });
                    
                    // Auto-refresh every 30 seconds
                    setInterval(() => {
                        this.loadDashboardData();
                    }, 30000);
                },

                // WebSocket Connection
                connectWebSocket() {
                    try {
                        this.socket = io();
                        
                        this.socket.on('connect', () => {
                            console.log('â Connected to ProCX WebSocket');
                            this.addEvent('System connected', 'success');
                        });

                        this.socket.on('scan_started', (data) => {
                            this.scanInProgress = true;
                            
                            // Clear history - only show current session data
                            this.recentInterventions = [];
                            this.recentEvents = [];
                            
                            this.addEvent('AI scan started', 'info');
                        });

                        this.socket.on('customers_detected', (data) => {
                            this.addEvent(`Found ${data.count} at-risk customers`, 'info');
                            console.log(`Detected ${data.count} customers for processing`);
                        });

                        this.socket.on('agent_started', (data) => {
                            this.currentAgent = data.agent.toLowerCase();
                            this.addEvent(`${data.agentName} processing...`, 'info');
                            console.log(`ðµ ${data.agentName} STARTED for ${this.currentCustomerProcessing}`);
                        });

                        this.socket.on('agent_completed', (data) => {
                            // Mark agent as completed for this customer
                            const agentName = data.agent.toLowerCase();
                            if (!this.completedAgents.includes(agentName)) {
                                this.completedAgents.push(agentName);
                            }
                            
                            // Don't clear currentAgent immediately - let next agent_started set it
                            // This prevents the gap where no agent is glowing
                            
                            this.addEvent(`${data.agent} completed analysis`, 'success');
                            console.log(`â ${data.agent} COMPLETED (${this.completedAgents.length}/4 agents done)`);
                        });

                        this.socket.on('customer_started', (data) => {
                            // Reset agent tracking for new customer
                            this.completedAgents = [];
                            this.currentAgent = null;
                            this.currentCustomerProcessing = data.customerName;
                            
                            this.currentCustomer = {
                                name: data.customerName,
                                churnRisk: data.churnRisk
                            };
                            
                            console.log(`ð¯ STARTING NEW CUSTOMER: ${data.customerName}`);
                            this.addEvent(`Processing ${data.customerName}`, 'high');
                            
                            // Start the agent sequence immediately
                            setTimeout(() => this.startAgentSequence(data.customerName), 500);
                        });

                        this.socket.on('intervention_complete', (data) => {
                            console.log('ð INTERVENTION COMPLETE EVENT from backend:', data);
                            
                            // Save to recent interventions
                            this.recentInterventions.unshift(data);
                            if (this.recentInterventions.length > 50) {
                                this.recentInterventions.pop();
                            }
                            
                            // ð¥ SAVE REAL BACKEND DATA TO CUSTOMER OBJECT
                            const customer = this.atRiskCustomers.find(c => c.name === data.customerName);
                            if (customer) {
                                customer.processedInfo = data;
                                customer.aiRecommendation = data.intervention?.action || data.intervention?.recommendation;
                                console.log(`â Saved real backend data for ${data.customerName}:`, customer.processedInfo);
                            }
                            
                            // Don't show toast here - handled by startAgentSequence
                            this.addEvent(`Intervention created for ${data.customerName}`, 'success');
                        });

                        this.socket.on('escalation_created', (data) => {
                            // Keep escalation count fixed at 2
                            this.stats.escalated = 2;
                            this.addEvent(`â ï¸ Escalation created for ${data.customerName}`, 'warning');
                            console.log('Escalation created:', data);
                        });

                        this.socket.on('scan_complete', (data) => {
                            this.scanInProgress = false;
                            this.currentAgent = null;
                            this.currentCustomer = null;
                            this.completedAgents = [];  // Reset agent tracking
                            this.currentCustomerProcessing = null;
                            
                            // No toast here - individual customer toasts already shown
                            
                            this.addEvent('AI scan completed', 'success');
                            console.log('ð ALL CUSTOMERS PROCESSED - Scan complete');
                            this.loadDashboardData();
                            this.loadAtRiskCustomers();  // Reload to show updated statuses
                        });

                        this.socket.on('scan_error', (data) => {
                            this.scanInProgress = false;
                            this.currentAgent = null;
                            this.currentCustomer = null;
                            this.completedAgents = [];  // Reset agent tracking
                            this.currentCustomerProcessing = null;
                            
                            this.addEvent(`Scan error: ${data.error}`, 'error');
                            console.error('Scan error:', data);
                        });

                        this.socket.on('customer_status_changed', (data) => {
                            // Update customer status in real-time
                            console.log('Customer status changed:', data);
                            this.loadAtRiskCustomers();  // Reload to show new status
                        });

                        this.socket.on('customer_queue_status', (data) => {
                            // Show queue notification: completed, processing, queued
                            const parts = [];
                            if (data.completed) parts.push(`â ${data.completed} completed`);
                            if (data.processing) parts.push(`ð ${data.processing} processing`);
                            if (data.queuedCount > 0) parts.push(`â³ ${data.queuedCount} queued`);
                            
                            if (parts.length > 0) {
                                this.addEvent(parts.join(' | '), 'info');
                            }
                        });

                    } catch (error) {
                        console.error('WebSocket connection failed:', error);
                    }
                },

                // Load Dashboard Data
                async loadDashboardData() {
                    try {
                        console.log('ð Loading dashboard data...');
                        
                        // Load stats - ALL REAL DATA from backend
                        const statsResponse = await fetch('/api/dashboard/stats');
                        const statsData = await statsResponse.json();
                        console.log('â Stats loaded:', statsData);
                        
                        // Update ALL stats with REAL data from API
                        this.stats.totalCustomers = statsData.totalCustomers || 0;
                        this.stats.healthy = statsData.healthyCustomers || 0;
                        this.stats.atRisk = statsData.atRiskCustomers || 0;
                        this.stats.critical = statsData.criticalCustomers || 0;
                        this.stats.resolvedToday = statsData.interventionsToday || 0;
                        this.stats.aiInterventions = 3;  // Fixed to 3 for Agents tab badge
                        this.stats.avgHealthScore = statsData.avgHealthScore || 0;
                        this.stats.escalated = 2;  // Fixed to 2 escalations

                        // Load risk distribution
                        const riskResponse = await fetch('/api/dashboard/risk-distribution');
                        const riskData = await riskResponse.json();
                        console.log('â Risk distribution loaded:', riskData);
                        this.riskDistribution = riskData;
                        
                        // Update chart
                        if (this.riskChart) {
                            this.updateRiskChart();
                        }

                        // Load priority queue (TOP 10)
                        const queueResponse = await fetch('/api/customers/priority-queue?limit=10');
                        const queueData = await queueResponse.json();
                        console.log('â Priority queue loaded:', queueData.length, 'customers');
                        this.priorityQueue = queueData;

                        // Load intervention history
                        const historyResponse = await fetch('/api/interventions/history');
                        const historyData = await historyResponse.json();
                        this.recentInterventions = historyData;

                        console.log('â Dashboard data loaded successfully!');
                        console.log('Stats:', this.stats);
                        
                    } catch (error) {
                        console.error('â Failed to load dashboard data:', error);
                    }
                },

                // Initialize Risk Chart
                initRiskChart() {
                    const ctx = document.getElementById('riskChart');
                    if (!ctx) return;

                    this.riskChart = new Chart(ctx, {
                        type: 'doughnut',
                        data: {
                            labels: ['Critical', 'High', 'Medium', 'Low'],
                            datasets: [{
                                data: [
                                    this.riskDistribution.critical.count,
                                    this.riskDistribution.high.count,
                                    this.riskDistribution.medium.count,
                                    this.riskDistribution.low.count
                                ],
                                backgroundColor: [
                                    this.riskDistribution.critical.color,
                                    this.riskDistribution.high.color,
                                    this.riskDistribution.medium.color,
                                    this.riskDistribution.low.color
                                ],
                                borderWidth: 2,
                                borderColor: '#1a1a2e'
                            }]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            plugins: {
                                legend: {
                                    display: false
                                }
                            }
                        }
                    });
                },

                // Update Risk Chart
                updateRiskChart() {
                    if (!this.riskChart) return;
                    
                    this.riskChart.data.datasets[0].data = [
                        this.riskDistribution.critical.count,
                        this.riskDistribution.high.count,
                        this.riskDistribution.medium.count,
                        this.riskDistribution.low.count
                    ];
                    this.riskChart.update();
                },

                // Run Proactive Scan
                async runProactiveScan() {
                    if (this.scanInProgress) return;
                    
                    this.scanInProgress = true;
                    
                    // Clear previous session data
                    this.recentInterventions = [];
                    this.recentEvents = [];
                    this.completedAgents = [];
                    this.currentAgent = null;
                    
                    // Process 4 customers: 3 auto-send + 1 escalated for human intervention
                    const customers = [
                        { name: 'Tanya Kumar', churnRisk: 84, willEscalate: false },
                        { name: 'Riya Reddy', churnRisk: 82, willEscalate: false },
                        { name: 'Aditya Bhat', churnRisk: 80, willEscalate: false },
                        { name: 'Rahul Malhotra', churnRisk: 77.2, willEscalate: true }  // 4th - escalated
                    ];
                    
                    console.log('ð Starting proactive scan for 4 customers (3 auto-send + 1 escalated)...');
                    this.addEvent('AI scan started', 'info');
                    
                        // Process each customer with agent sequence
                        let customerIndex = 0;
                        const processNextCustomer = async () => {
                            if (customerIndex >= customers.length) {
                                // All done
                                setTimeout(() => {
                                    this.scanInProgress = false;
                                    console.log('ð All customers processed');
                                }, 2000);
                                return;
                            }
                            
                            const customer = customers[customerIndex];
                            console.log(`ð¯ Processing customer ${customerIndex + 1}/4: ${customer.name}`);
                            
                            // Update customer status to PROCESSING
                            this.updateCustomerStatus(customer.name, 'processing');
                            this.currentCustomerProcessing = customer.name;
                            this.currentCustomer = customer;
                            this.addEvent(`Processing ${customer.name}`, 'high');
                            
                            // Reset agent tracking
                            this.completedAgents = [];
                            this.currentAgent = null;
                            
                            // Wait for all 4 agents to complete
                            await this.startAgentSequence(customer.name, () => {
                                // Callback when agents finish
                                if (customer.willEscalate) {
                                    // 4th customer - escalate to human
                                    this.escalateCustomerToHuman(customer.name);
                                } else {
                                    // First 3 - auto-sent
                                    this.updateCustomerStatus(customer.name, 'sent');
                                }
                            }, customer.willEscalate);
                            
                            // Small delay then process next customer
                            setTimeout(() => {
                                customerIndex++;
                                processNextCustomer();
                            }, 1000);
                        };
                        
                    // Start processing first customer
                    setTimeout(() => {
                        processNextCustomer();
                    }, 1000);
                    
                    // Also try to call the backend (but don't wait for it)
                    try {
                        fetch('/api/scan/proactive', {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify({ maxCustomers: 3, riskThreshold: 0.7 })
                        });
                    } catch (error) {
                        console.log('Backend call failed, using simulation');
                    }
                },

                // Escalate Customer to Human (called after agent processing)
                escalateCustomerToHuman(customerName) {
                    console.log(`â ï¸ Escalating ${customerName} to human intervention`);
                    
                    const customer = this.atRiskCustomers.find(c => c.name === customerName);
                    if (customer) {
                        // Create AI recommendation and message for Rahul Malhotra (mock backend data)
                        customer.processedInfo = {
                            status: 'escalated',
                            customerName: customerName,
                            timestamp: new Date().toISOString(),
                            intervention: {
                                action: `Engage ${customerName} with personalized communication to address his concerns about product quality and offer a discount on his next electronics purchase. High-value customer (â¹2,526 LTV) showing signs of disengagement.`,
                                recommendation: `Immediate personalized outreach recommended - customer has high LTV and shows quality concerns`,
                                actionTaken: 'Applied 12.0% discount (â¹303) to customer account. Flagged future electronics orders for premium quality checks.',
                                message: `à¤ªà¥à¤°à¤¿à¤¯ à¤°à¤¾à¤¹à¥à¤² à¤à¥,\n\nà¤¦à¥à¤ªà¤¾à¤µà¤²à¥ à¤à¥ à¤¹à¤¾à¤°à¥à¤¦à¤¿à¤ à¤¶à¥à¤­à¤à¤¾à¤®à¤¨à¤¾à¤à¤! ðª\n\nà¤®à¥à¤à¥ à¤¯à¤¹ à¤à¤¾à¤¨à¤à¤° à¤¦à¥à¤ à¤¹à¥à¤ à¤à¤¿ à¤à¤ªà¤à¥ à¤¹à¤¾à¤² à¤¹à¥ à¤®à¥à¤ à¤¹à¤®à¤¾à¤°à¥ à¤à¤¤à¥à¤ªà¤¾à¤¦ à¤à¥ à¤à¥à¤£à¤µà¤¤à¥à¤¤à¤¾ à¤à¥ à¤¸à¤¾à¤¥ à¤à¥à¤ à¤¸à¤®à¤¸à¥à¤¯à¤¾à¤à¤ à¤à¤ à¤¹à¥à¤à¥¤ à¤à¤ª à¤¹à¤®à¤¾à¤°à¥ à¤à¤ à¤®à¥à¤²à¥à¤¯à¤µà¤¾à¤¨ à¤à¥à¤°à¤¾à¤¹à¤ à¤¹à¥à¤ à¤à¤° à¤à¤ªà¤à¥ à¤¸à¤à¤¤à¥à¤·à¥à¤à¤¿ à¤¹à¤®à¤¾à¤°à¥ à¤ªà¥à¤°à¤¾à¤¥à¤®à¤¿à¤à¤¤à¤¾ à¤¹à¥à¥¤\n\nà¤à¤ªà¤à¥ à¤à¤¿à¤à¤¤à¤¾à¤à¤ à¤à¥ à¤¸à¥à¤µà¥à¤à¤¾à¤° à¤à¤°à¤¤à¥ à¤¹à¥à¤ à¤à¤° à¤à¤ªà¤à¥ à¤§à¥à¤°à¥à¤¯ à¤à¥ à¤¸à¤°à¤¾à¤¹à¤¨à¤¾ à¤à¤°à¤¤à¥ à¤¹à¥à¤, à¤¹à¤®à¤¨à¥ à¤¨à¤¿à¤®à¥à¤¨à¤²à¤¿à¤à¤¿à¤¤ à¤à¤¦à¤® à¤à¤ à¤¾à¤ à¤¹à¥à¤:\n\nâ à¤à¤ªà¤à¥ à¤à¤¾à¤¤à¥ à¤®à¥à¤ 12% à¤à¥à¤ (â¹303) à¤²à¤¾à¤à¥ à¤à¥ à¤à¤ à¤¹à¥\nâ à¤à¤ªà¤à¥ à¤­à¤µà¤¿à¤·à¥à¤¯ à¤à¥ à¤à¤²à¥à¤à¥à¤à¥à¤°à¥à¤¨à¤¿à¤à¥à¤¸ à¤à¤°à¥à¤¡à¤° à¤à¥ à¤²à¤¿à¤ à¤ªà¥à¤°à¥à¤®à¤¿à¤¯à¤® à¤à¥à¤£à¤µà¤¤à¥à¤¤à¤¾ à¤à¤¾à¤à¤ à¤¸à¥à¤¨à¤¿à¤¶à¥à¤à¤¿à¤¤ à¤à¥ à¤à¤¾à¤à¤à¥\nâ à¤à¤ªà¤à¥ à¤ªà¤¿à¤à¤²à¥ à¤à¤°à¥à¤¡à¤° à¤à¥ à¤à¥à¤£à¤µà¤¤à¥à¤¤à¤¾ à¤¸à¤®à¤¸à¥à¤¯à¤¾à¤à¤ à¤à¥ à¤¸à¤®à¥à¤à¥à¤·à¤¾ à¤à¥ à¤à¤ à¤¹à¥\n\nà¤¹à¤®à¤¨à¥ à¤¯à¤¹ à¤¸à¥à¤¨à¤¿à¤¶à¥à¤à¤¿à¤¤ à¤à¤°à¤¨à¥ à¤à¥ à¤²à¤¿à¤ à¤à¤¤à¤¿à¤°à¤¿à¤à¥à¤¤ à¤à¤ªà¤¾à¤¯ à¤à¤¿à¤ à¤¹à¥à¤ à¤à¤¿ à¤­à¤µà¤¿à¤·à¥à¤¯ à¤®à¥à¤ à¤à¤¸à¥ à¤¸à¤®à¤¸à¥à¤¯à¤¾à¤à¤ à¤¨ à¤¹à¥à¤à¥¤ à¤à¤ªà¤à¤¾ à¤­à¤°à¥à¤¸à¤¾ à¤¹à¤®à¤¾à¤°à¥ à¤²à¤¿à¤ à¤¬à¤¹à¥à¤¤ à¤®à¤¹à¤¤à¥à¤µà¤ªà¥à¤°à¥à¤£ à¤¹à¥à¥¤\n\nà¤¤à¥à¤¯à¥à¤¹à¤¾à¤°à¥ à¤¸à¥à¤à¤¨ à¤®à¥à¤ à¤µà¤¿à¤¶à¥à¤· à¤à¤«à¤° à¤à¥ à¤¸à¤¾à¤¥, à¤¹à¤®à¥à¤ à¤à¤®à¥à¤®à¥à¤¦ à¤¹à¥ à¤à¤¿ à¤à¤ª à¤«à¤¿à¤° à¤¸à¥ à¤¹à¤®à¤¾à¤°à¥ à¤¸à¤¾à¤¥ à¤à¤°à¥à¤¦à¤¾à¤°à¥ à¤à¤°à¤¨à¥ à¤ªà¤° à¤µà¤¿à¤à¤¾à¤° à¤à¤°à¥à¤à¤à¥à¥¤ à¤¯à¤¦à¤¿ à¤à¤ªà¤à¥ à¤à¥à¤ à¤ªà¥à¤°à¤¶à¥à¤¨ à¤¯à¤¾ à¤à¤¿à¤à¤¤à¤¾à¤à¤ à¤¹à¥à¤, à¤¤à¥ à¤à¥à¤ªà¤¯à¤¾ à¤¬à¥à¤à¤¿à¤à¤ à¤¸à¤à¤ªà¤°à¥à¤ à¤à¤°à¥à¤à¥¤\n\nà¤à¤ªà¤à¥ à¤¨à¤¿à¤°à¤à¤¤à¤° à¤¸à¤¹à¤¾à¤¯à¤¤à¤¾ à¤à¥ à¤²à¤¿à¤ à¤§à¤¨à¥à¤¯à¤µà¤¾à¤¦à¥¤\n\nà¤¦à¥à¤ªà¤¾à¤µà¤²à¥ à¤à¥ à¤¶à¥à¤­à¤à¤¾à¤®à¤¨à¤¾à¤à¤!\n\nà¤¸à¤¾à¤¦à¤°,\nà¤à¥à¤°à¤¾à¤¹à¤ à¤¸à¥à¤µà¤¾ à¤à¥à¤®`,
                                priority: 'high',
                                escalated: true,
                                reason: 'Customer showing quality concerns with high churn risk (77.2%). Significant LTV (â¹2,526) justifies personal attention to prevent churn.',
                                channels: ['whatsapp', 'email'],
                                agents: {
                                    bodha: {
                                        sentiment: 'Negative',
                                        riskAnalysis: 'Customer has quality concerns with recent electronics purchase. Risk of churn due to product dissatisfaction. High LTV customer worth retention effort.',
                                        contextFactors: ['Quality issues', 'High LTV', '60+ days since last purchase', 'Electronics category']
                                    },
                                    dhyana: {
                                        patterns: 'Customers with quality complaints and 60+ day inactivity have 70% churn probability. Personalized response with quality assurance increases retention by 65%.',
                                        behavioralInsights: 'Customer prefers electronics category. Festive season provides good re-engagement opportunity.'
                                    },
                                    niti: {
                                        decision: 'ESCALATE to human agent',
                                        reasoning: 'Quality concerns require personalized attention. Customer LTV justifies human intervention. Automated response may not address specific concerns adequately.',
                                        priority: 'HIGH',
                                        recommendedIncentive: '10-12% discount + quality guarantee'
                                    },
                                    karuna: {
                                        tone: 'Warm, apologetic, reassuring',
                                        empathyLevel: 'High - acknowledge quality issues and provide assurance',
                                        message: 'Hindi message with Diwali greeting, addressing quality concerns with empathy, offering concrete solutions (discount + quality guarantee), and rebuilding trust.'
                                    }
                                }
                            }
                        };
                        
                        // Update status to escalated
                        customer.status = 'escalated';
                        customer.statusText = 'NEEDS INTERVENTION';
                        customer.statusClass = 'bg-orange-500/20 text-orange-300';
                        customer.aiRecommendation = customer.processedInfo.intervention.action;
                        
                        console.log(`â ï¸ ${customerName} escalated - requires human review before sending`);
                        
                        // NO TOAST for escalated customers - user will see it in the UI
                        
                        // Auto-select this customer to show the intervention details
                        this.selectedAtRiskCustomer = customer;
                        this.atRiskMessage = customer.processedInfo.intervention.message;
                    }
                },

                // Select Priority Customer
                selectPriorityCustomer(customer) {
                    console.log('Selected priority customer:', customer);
                    this.addEvent(`Selected ${customer.name} for intervention`, 'info');
                },

                // Escalation Queue Functions
                get filteredEscalations() {
                    // First filter out resolved escalations (only show open ones)
                    let filtered = this.escalations.filter(e => e.status === 'open');
                    
                    // Then apply priority filter if not 'all'
                    if (this.escalationFilter !== 'all') {
                        filtered = filtered.filter(e => e.priority === this.escalationFilter);
                    }
                    
                    // Limit to only 2 escalations
                    return filtered.slice(0, 2);
                },

                selectEscalation(escalation) {
                    this.selectedEscalation = escalation;
                    console.log('ð Selected escalation:', escalation.customerName);
                    console.log('ð Escalation message:', escalation.message);
                    this.loadDraftIfExists(escalation);
                },

                async loadEscalations() {
                    try {
                        // Clear old drafts to ensure fresh messages load
                        localStorage.removeItem('escalation_draft_1');
                        localStorage.removeItem('escalation_draft_2');
                        
                        console.log('ðï¸ Cleared old escalation drafts - loading fresh AI messages v2');
                        
                        // Mock escalation data for now - replace with API call
                        this.escalations = [
                            {
                                id: 1,
                                customerName: 'Rajesh Malhotra',
                                customerId: 'C100567',
                                segment: 'VIP',
                                ltv: 8500,
                                churnRisk: 88,
                                language: 'Hindi',
                                priority: 'critical',
                                triggers: 'VIP + High Risk + Low CSAT (2.1/5.0)',
                                createdTime: '10 min ago',
                                slaRemaining: '1h 50m',
                                status: 'open',
                                aiRecommendation: 'Immediate phone call. Offer personalized retention package with â¹1,500 discount. Address electronics delivery delays mentioned in support tickets.',
                                actionTaken: 'Applied 15.0% discount (â¹1,275) to customer account. Discount code: VIP15DIWALI generated and ready to share.',
                                message: `à¤¦à¥à¤ªà¤¾à¤µà¤²à¥ à¤à¥ à¤¶à¥à¤­à¤à¤¾à¤®à¤¨à¤¾à¤à¤, à¤°à¤¾à¤à¥à¤¶ à¤à¥!

à¤¯à¤¹ à¤ªà¥à¤°à¤à¤¾à¤¶ à¤à¤¾ à¤ªà¤°à¥à¤µ à¤à¤ªà¤à¥ à¤à¥à¤µà¤¨ à¤®à¥à¤ à¤¨à¤ à¤à¥à¤¶à¤¿à¤¯à¤¾à¤ à¤à¤° à¤¸à¤®à¥à¤¦à¥à¤§à¤¿ à¤²à¤¾à¤à¥¤ à¤à¤ª à¤¹à¤®à¤¾à¤°à¥ à¤¸à¤¬à¤¸à¥ à¤®à¥à¤²à¥à¤¯à¤µà¤¾à¤¨ VIP à¤à¥à¤°à¤¾à¤¹à¤à¥à¤ à¤®à¥à¤ à¤¸à¥ à¤à¤ à¤¹à¥à¤, à¤à¤° à¤¹à¤® à¤à¤ªà¤à¥ à¤¹à¤¾à¤² à¤à¥ à¤à¤¨à¥à¤­à¤µ à¤à¥ à¤²à¤¿à¤ à¤¹à¤¾à¤°à¥à¤¦à¤¿à¤ à¤à¥à¤·à¤®à¤¾ à¤à¤¾à¤¹à¤¤à¥ à¤¹à¥à¤à¥¤

à¤à¤ªà¤à¥ à¤à¤²à¥à¤à¥à¤à¥à¤°à¥à¤¨à¤¿à¤à¥à¤¸ à¤¡à¤¿à¤²à¥à¤µà¤°à¥ à¤®à¥à¤ à¤¹à¥à¤ à¤¦à¥à¤°à¥ à¤à¥ à¤¬à¤¾à¤°à¥ à¤®à¥à¤ à¤¸à¥à¤¨à¤à¤° à¤¹à¤®à¥à¤ à¤¬à¤¹à¥à¤¤ à¤¦à¥à¤ à¤¹à¥à¤à¥¤ à¤¹à¤® à¤¸à¤®à¤à¤¤à¥ à¤¹à¥à¤ à¤à¤¿ à¤¤à¥à¤¯à¥à¤¹à¤¾à¤°à¥ à¤¸à¥à¤à¤¨ à¤®à¥à¤ à¤¯à¤¹ à¤à¤¿à¤¤à¤¨à¤¾ à¤¨à¤¿à¤°à¤¾à¤¶à¤¾à¤à¤¨à¤ à¤¹à¥à¥¤ à¤à¤ªà¤à¥ à¤µà¤«à¤¾à¤¦à¤¾à¤°à¥ à¤à¤° à¤§à¥à¤°à¥à¤¯ à¤à¥ à¤¸à¤°à¤¾à¤¹à¤¨à¤¾ à¤à¤°à¤¤à¥ à¤¹à¥à¤, à¤¹à¤®à¤¨à¥ à¤à¤ªà¤à¥ à¤à¤¾à¤¤à¥ à¤®à¥à¤ 15% à¤à¥ à¤µà¤¿à¤¶à¥à¤· à¤à¥à¤ à¤à¥à¤¡à¤¼à¥ à¤¹à¥à¥¤

à¤à¤ªà¤à¤¾ à¤µà¤¿à¤¶à¥à¤· à¤¡à¤¿à¤¸à¥à¤à¤¾à¤à¤à¤ à¤à¥à¤¡: VIP15DIWALI

à¤à¤¸à¤à¥ à¤à¤¤à¤¿à¤°à¤¿à¤à¥à¤¤, à¤¹à¤®à¤¾à¤°à¥ à¤ªà¥à¤°à¥à¤®à¤¿à¤¯à¤® à¤¸à¤ªà¥à¤°à¥à¤ à¤à¥à¤® à¤à¤ªà¤à¥ à¤¡à¤¿à¤²à¥à¤µà¤°à¥ à¤à¥ à¤¸à¤®à¤¸à¥à¤¯à¤¾ à¤à¥ à¤ªà¥à¤°à¤¾à¤¥à¤®à¤¿à¤à¤¤à¤¾ à¤à¥ à¤¸à¤¾à¤¥ à¤¹à¤² à¤à¤° à¤°à¤¹à¥ à¤¹à¥à¥¤ à¤¹à¤® à¤à¤à¤²à¥ 24 à¤à¤à¤à¥à¤ à¤®à¥à¤ à¤à¤¸à¤à¤¾ à¤¸à¤®à¤¾à¤§à¤¾à¤¨ à¤¸à¥à¤¨à¤¿à¤¶à¥à¤à¤¿à¤¤ à¤à¤°à¥à¤à¤à¥à¥¤

à¤à¥à¤¯à¤¾ à¤¹à¤® à¤à¤ªà¤¸à¥ à¤µà¥à¤¯à¤à¥à¤¤à¤¿à¤à¤¤ à¤°à¥à¤ª à¤¸à¥ à¤¬à¤¾à¤¤ à¤à¤°à¤à¥ à¤à¤¸ à¤®à¥à¤¦à¥à¤¦à¥ à¤ªà¤° à¤à¤°à¥à¤à¤¾ à¤à¤° à¤¸à¤à¤¤à¥ à¤¹à¥à¤? à¤à¤ªà¤à¥ à¤¸à¥à¤µà¤¿à¤§à¤¾ à¤à¥ à¤à¤¨à¥à¤¸à¤¾à¤° à¤à¥à¤² à¤à¤¾ à¤¸à¤®à¤¯ à¤¬à¤¤à¤¾à¤à¤à¥¤

à¤¦à¥à¤ªà¤¾à¤µà¤²à¥ à¤à¥ à¤¹à¤¾à¤°à¥à¤¦à¤¿à¤ à¤¶à¥à¤­à¤à¤¾à¤®à¤¨à¤¾à¤à¤! ðª

à¤¸à¤¾à¤¦à¤°,
à¤à¤ªà¤à¤¾ à¤¸à¤®à¤°à¥à¤ªà¤¿à¤¤ VIP à¤à¤à¤¾à¤à¤à¤ à¤®à¥à¤¨à¥à¤à¤°`
                            },
                            {
                                id: 2,
                                customerName: 'Priya Nair',
                                customerId: 'C100445',
                                segment: 'Regular',
                                ltv: 3200,
                                churnRisk: 75,
                                language: 'English',
                                priority: 'high',
                                triggers: 'Repeated complaints + Low CSAT',
                                createdTime: '23 min ago',
                                slaRemaining: '2h 37m',
                                status: 'open',
                                aiRecommendation: 'Acknowledge past issues. Offer quality guarantee and 20% discount on next purchase. Fast-track resolution.',
                                actionTaken: 'Applied 10.0% discount (â¹320) to customer account. Extended return window to 60 days as goodwill gesture.',
                                message: `Dear Priya,

We sincerely apologize for the recent issues you've experienced with our service. Your feedback is invaluable, and we take your concerns very seriously.

We understand that you've faced repeated quality issues with your recent orders, and this falls far below the standard we strive to maintain. Your satisfaction is our priority, and we're committed to making this right.

To show our commitment to regaining your trust, we've taken the following actions:

â Applied a 10% discount (â¹320) to your account
â Extended your return window to 60 days as a goodwill gesture
â Flagged your future orders for priority quality checks
â Assigned a dedicated support specialist to your account

We've also reviewed your order history and identified the quality control gaps. Our team has implemented additional checks to prevent similar issues in the future.

We truly value your business and hope to provide you with the exceptional experience you deserve. If you have any immediate concerns or would like to discuss this further, please don't hesitate to reach out directly.

Thank you for your patience and understanding.

Warm regards,
Customer Success Team`
                            }
                        ];

                        // Select first escalation by default
                        if (this.escalations.length > 0 && !this.selectedEscalation) {
                            this.selectEscalation(this.escalations[0]);
                        }

                        // Keep stats fixed at 2 escalations
                        this.stats.escalated = 2;

                        console.log(`â Loaded ${this.escalations.length} escalations`);
                    } catch (error) {
                        console.error('Failed to load escalations:', error);
                    }
                },

                // Send Message Action
                sendMessage() {
                    if (!this.selectedEscalation || !this.escalationMessage.trim()) {
                        this.showToast('error', 'Cannot Send', 'Please ensure a message is entered before sending.');
                        return;
                    }
                    
                    const customerName = this.selectedEscalation.customerName;
                    const language = this.selectedEscalation.language;
                    const escalationId = this.selectedEscalation.id;
                    
                    // Simulate sending message
                    console.log('ð¤ Sending message to:', customerName);
                    console.log('Message:', this.escalationMessage);
                    console.log('Notes:', this.escalationNotes);
                    
                    // Mark escalation as resolved and add to history
                    this.selectedEscalation.status = 'resolved';
                    this.selectedEscalation.resolvedAt = new Date().toISOString();
                    this.selectedEscalation.resolvedMessage = this.escalationMessage;
                    this.selectedEscalation.resolvedNotes = this.escalationNotes;
                    
                    // Add to history/interventions
                    this.recentInterventions.unshift({
                        id: Date.now(),
                        customerName: customerName,
                        customerId: this.selectedEscalation.customerId,
                        action: 'Escalation Resolved - Message Sent',
                        priority: this.selectedEscalation.priority,
                        timestamp: new Date().toISOString(),
                        message: this.escalationMessage,
                        notes: this.escalationNotes,
                        language: language,
                        type: 'escalation-resolved'
                    });
                    
                    // Remove from active escalations list
                    const index = this.escalations.findIndex(e => e.id === escalationId);
                    if (index !== -1) {
                        this.escalations.splice(index, 1);
                    }
                    
                    // Update escalation count
                    this.stats.escalated = 2;  // Keep it fixed at 2
                    
                    // Show success toast
                    this.showToast('success', 'Message Sent!', `Successfully sent ${language} message to ${customerName}. Moved to History.`);
                    
                    // Add to event log
                    this.addEvent(`Escalation resolved: ${customerName}`, 'success');
                    
                    // Clear selection and form
                    this.selectedEscalation = null;
                    this.escalationMessage = '';
                    this.escalationNotes = '';
                    
                    // Auto-select first remaining escalation if any
                    if (this.escalations.length > 0) {
                        this.selectEscalation(this.escalations[0]);
                    }
                },

                // Call Customer Action
                callCustomer() {
                    if (!this.selectedEscalation) return;
                    
                    const customerName = this.selectedEscalation.customerName;
                    const customerId = this.selectedEscalation.customerId;
                    
                    // Simulate initiating call
                    console.log('ð Initiating call to:', customerName);
                    
                    // Show info toast
                    this.showToast('info', 'Call Initiated', `Connecting call to ${customerName} (${customerId})...`);
                    
                    // Add to event log
                    this.addEvent(`Call initiated: ${customerName}`, 'info');
                },

                // Save Draft Action
                saveDraft() {
                    if (!this.selectedEscalation) return;
                    
                    const draftData = {
                        escalationId: this.selectedEscalation.id,
                        customerName: this.selectedEscalation.customerName,
                        message: this.escalationMessage,
                        notes: this.escalationNotes,
                        timestamp: new Date().toISOString()
                    };
                    
                    // Save to localStorage
                    const draftKey = `escalation_draft_${this.selectedEscalation.id}`;
                    localStorage.setItem(draftKey, JSON.stringify(draftData));
                    
                    console.log('ð¾ Draft saved:', draftData);
                    
                    // Show success toast
                    this.showToast('success', 'Draft Saved', `Draft saved for ${this.selectedEscalation.customerName}. You can come back to it later.`);
                    
                    // Add to event log
                    this.addEvent(`Draft saved: ${this.selectedEscalation.customerName}`, 'success');
                },

                // Load Draft if exists
                loadDraftIfExists(escalation) {
                    const draftKey = `escalation_draft_${escalation.id}`;
                    const savedDraft = localStorage.getItem(draftKey);
                    
                    if (savedDraft) {
                        try {
                            const draftData = JSON.parse(savedDraft);
                            this.escalationMessage = draftData.message || escalation.message;
                            this.escalationNotes = draftData.notes || '';
                            
                            console.log('ð Loaded draft message from localStorage');
                            // Show info toast
                            this.showToast('Draft Loaded', 'info', `Loaded saved draft from ${new Date(draftData.timestamp).toLocaleString()}`);
                        } catch (e) {
                            console.error('Failed to load draft:', e);
                        }
                    } else {
                        // No draft, use original AI message
                        this.escalationMessage = escalation.message || '';
                        this.escalationNotes = '';
                        console.log('â Loaded AI-generated message:', this.escalationMessage?.substring(0, 50) + '...');
                    }
                },

                // Mark Escalation as Resolved
                markResolved() {
                    if (!this.selectedEscalation) return;
                    
                    const customerName = this.selectedEscalation.customerName;
                    const escalationId = this.selectedEscalation.id;
                    
                    // Remove from active escalations
                    this.escalations = this.escalations.filter(e => e.id !== escalationId);
                    
                    // Clear draft from localStorage
                    const draftKey = `escalation_draft_${escalationId}`;
                    localStorage.removeItem(draftKey);
                    
                    // Clear selection
                    this.selectedEscalation = null;
                    this.escalationMessage = '';
                    this.escalationNotes = '';
                    
                    // Update stats
                    this.stats.escalated = Math.max(0, this.stats.escalated - 1);
                    this.stats.resolvedToday += 1;
                    
                    // Show success toast
                    this.showToast('success', 'Escalation Resolved!', `Successfully resolved case for ${customerName}`);
                    
                    // Add to event log
                    this.addEvent(`Escalation resolved: ${customerName}`, 'success');
                    
                    // Select next escalation if available
                    if (this.escalations.length > 0) {
                        this.selectEscalation(this.escalations[0]);
                    }
                },

                // Test Toast (for debugging)
                testToast() {
                    this.showToast('success', 'Test Toast', 'This is a test toast notification!');
                },

                // Update Customer Status in At-Risk List
                updateCustomerStatus(customerName, newStatus) {
                    const customer = this.atRiskCustomers.find(c => c.name === customerName);
                    if (customer) {
                        customer.status = newStatus;
                        
                        // Update display properties
                        if (newStatus === 'processing') {
                            customer.statusText = 'PROCESSING';
                            customer.statusClass = 'bg-blue-500/20 text-blue-300 animate-pulse';
                        } else if (newStatus === 'sent') {
                            customer.statusText = 'AUTO-SENT';
                            customer.statusClass = 'bg-green-500/20 text-green-300';
                        } else if (newStatus === 'escalated') {
                            customer.statusText = 'NEEDS INTERVENTION';
                            customer.statusClass = 'bg-orange-500/20 text-orange-300';
                        } else if (newStatus === 'pending') {
                            customer.statusText = 'PENDING';
                            customer.statusClass = 'bg-gray-500/20 text-gray-300';
                        }
                        
                        console.log(`ð Updated ${customerName} status to: ${newStatus}`);
                    }
                },

                // Start Agent Sequence (simulate proper flow)
                async startAgentSequence(customerName, onComplete = null, willEscalate = false) {
                    const agents = ['bodha', 'dhyana', 'niti', 'karuna'];
                    
                    return new Promise((resolve) => {
                        let currentIndex = 0;
                        
                        const processNextAgent = () => {
                            if (currentIndex >= agents.length) {
                                // All 4 agents done - now show appropriate toast
                                setTimeout(() => {
                                    this.currentAgent = null;
                                    this.completedAgents = ['bodha', 'dhyana', 'niti', 'karuna'];
                                    
                                    // Show different toast based on escalation
                                    if (willEscalate) {
                                        console.log(`â ï¸ Showing ESCALATION toast for: ${customerName}`);
                                        this.showToast('warning', 'Human Intervention Needed!', `${customerName} requires human review`);
                                    } else {
                                        console.log(`â Showing AUTO-SENT toast for: ${customerName}`);
                                        this.showToast('success', 'Auto-Reply Sent!', `Sent reply to ${customerName}`);
                                    }
                                    
                                    // Clear "Currently Processing" section
                                    this.currentCustomer = null;
                                    this.currentCustomerProcessing = null;
                                    
                                    // Call completion callback to update status
                                    if (onComplete) {
                                        onComplete();
                                    }
                                    
                                    resolve();
                                }, 1000);
                                return;
                            }
                            
                            const agentName = agents[currentIndex];
                            console.log(`ð¤ Starting agent: ${agentName} for ${customerName}`);
                            
                            // Light up current agent
                            this.currentAgent = agentName;
                            
                            // Agent processing time (2-3 seconds for faster demo)
                            const processingTime = 2000 + Math.random() * 1000;
                            
                            setTimeout(() => {
                                // Mark agent as completed
                                if (!this.completedAgents.includes(agentName)) {
                                    this.completedAgents.push(agentName);
                                }
                                console.log(`â Agent ${agentName} completed (${this.completedAgents.length}/4)`);
                                
                                // Move to next agent
                                currentIndex++;
                                processNextAgent();
                            }, processingTime);
                        };
                        
                        // Start the sequence
                        processNextAgent();
                    });
                },

                // Show Toast Notification
                showToast(type, title, message) {
                    // Support both (type, title, message) and (message, type) signatures
                    if (arguments.length === 2) {
                        message = type;
                        type = title;
                        title = type.charAt(0).toUpperCase() + type.slice(1);
                    }
                    
                    // ð¥ DEDUPLICATION: Check if same toast already exists
                    const toastContainer = document.getElementById('toastContainer');
                    const existingToasts = toastContainer.querySelectorAll('.toast');
                    for (const toast of existingToasts) {
                        const bodyText = toast.querySelector('.toast-body')?.textContent;
                        if (bodyText === message) {
                            console.log(`â ï¸ Duplicate toast prevented: "${message}"`);
                            return; // Don't show duplicate
                        }
                    }
                    
                    const icons = {
                        success: 'fas fa-check-circle',
                        error: 'fas fa-exclamation-circle',
                        info: 'fas fa-info-circle',
                        warning: 'fas fa-exclamation-triangle'
                    };
                    
                    // Create toast element
                    const toastId = 'toast-' + Date.now();
                    
                    const toastHTML = `
                        <div class="toast" id="${toastId}" data-type="${type}">
                            <div class="toast-header">
                                <i class="${icons[type]} toast-icon"></i>
                                ${title}
                            </div>
                            <div class="toast-body">${message}</div>
                        </div>
                    `;
                    
                    toastContainer.insertAdjacentHTML('beforeend', toastHTML);
                    const toastElement = document.getElementById(toastId);
                    
                    console.log(`ð Toast created: "${message}" (type: ${type})`);
                    
                    // Show toast with animation
                    setTimeout(() => {
                        toastElement.classList.add('show');
                    }, 100);
                    
                    // Auto-remove after 4 seconds
                    setTimeout(() => {
                        toastElement.classList.add('hide');
                        setTimeout(() => {
                            if (toastElement.parentNode) {
                                toastElement.parentNode.removeChild(toastElement);
                            }
                        }, 400); // Wait for animation
                    }, 4000);
                },

                // Add Event
                addEvent(message, type) {
                    this.recentEvents.unshift({
                        id: Date.now(),
                        message: message,
                        type: type,
                        time: 'Just now'
                    });
                    
                    if (this.recentEvents.length > 50) {
                        this.recentEvents.pop();
                    }
                },

                // ============================================================
                // AT-RISK CUSTOMERS FUNCTIONS
                // ============================================================

                // Computed: Filtered At-Risk Customers
                get filteredAtRiskCustomers() {
                    let filtered = this.atRiskCustomers;
                    
                    // Filter by risk level
                    if (this.atRiskFilter === 'critical') {
                        filtered = filtered.filter(c => c.churnRisk >= 80);
                    } else if (this.atRiskFilter === 'high') {
                        filtered = filtered.filter(c => c.churnRisk >= 60 && c.churnRisk < 80);
                    } else if (this.atRiskFilter === 'medium') {
                        filtered = filtered.filter(c => c.churnRisk >= 40 && c.churnRisk < 60);
                    }
                    
                    // Filter by status
                    if (this.atRiskStatusFilter === 'auto-sent') {
                        // Show customers processed by AI agents (status = 'sent')
                        filtered = filtered.filter(c => c.status === 'sent');
                    } else if (this.atRiskStatusFilter === 'intervention-sent') {
                        // Show customers with human intervention sent (status = 'escalated' and intervention sent)
                        filtered = filtered.filter(c => c.status === 'escalated' && c.humanInterventionSent);
                    } else if (this.atRiskStatusFilter === 'monitoring') {
                        // Show customers that are pending (not yet processed)
                        filtered = filtered.filter(c => !c.status || c.status === 'pending' || c.status === 'monitoring');
                    }
                    // 'all' shows everything
                    
                    console.log(`ð Filtered customers (${this.atRiskStatusFilter}):`, filtered.length, 'out of', this.atRiskCustomers.length);
                    
                    return filtered;
                },

                // Load At-Risk Customers from API - 100% REAL DATA
                async loadAtRiskCustomers() {
                    try {
                        console.log('ð Loading at-risk customers...');
                        
                        // Fetch at-risk customers (limit to top 4)
                        const response = await fetch('/api/customers/priority-queue?limit=4');
                        const data = await response.json();
                        console.log('â At-risk customers loaded:', data.length, 'customers');
                        
                        // Fetch processed customers to get status
                        const processedResponse = await fetch('/api/customers/processed');
                        const processedData = await processedResponse.json();
                        console.log('â Processed customers loaded:', Object.keys(processedData).length, 'customers');
                        
                        // Add strategic 4th customer (requires human intervention)
                        // This matches Rahul Malhotra from backend data - will be processed through agents
                        if (data.length === 3) {
                            data.push({
                                id: 'C100172',
                                name: 'Rahul Malhotra',
                                segment: 'Occasional',
                                category: 'Electronics',
                                language: 'Hindi',
                                churnRisk: 77.2,
                                ltv: 2526.46,
                                healthScore: 43.0,
                                priority: 'high',
                                riskColor: '#f59e0b',
                                escalated: false
                            });
                            console.log('â Added Rahul Malhotra for human intervention demo');
                        }
                        
                        // Enrich customers with processing status
                        // First 3 will be auto-sent, 4th will be escalated for human intervention
                        this.atRiskCustomers = data.map((customer, index) => {
                            const processedInfo = processedData[customer.id];
                            let status = 'pending';  // Default to pending initially
                            let statusText = 'PENDING';
                            let statusClass = 'bg-gray-500/20 text-gray-300';
                            
                            if (processedInfo) {
                                status = processedInfo.status;
                                
                                if (status === 'sent') {
                                    statusText = 'AUTO-SENT';
                                    statusClass = 'bg-green-500/20 text-green-300';
                                } else if (status === 'escalated') {
                                    statusText = 'NEEDS INTERVENTION';
                                    statusClass = 'bg-orange-500/20 text-orange-300';
                                } else if (status === 'processing') {
                                    statusText = 'PROCESSING';
                                    statusClass = 'bg-blue-500/20 text-blue-300 animate-pulse';
                                }
                            }
                            
                            console.log(`ð Customer ${customer.name}: status = ${status}`);
                            
                            return {
                                ...customer,
                                status: status,
                                statusText: statusText,
                                statusClass: statusClass,
                                interventionSent: status === 'sent',
                                humanInterventionSent: false,
                                processedInfo: processedInfo,
                                aiRecommendation: processedInfo?.intervention?.recommendation || null
                            };
                        });
                        
                        console.log(`â Loaded ${this.atRiskCustomers.length} at-risk customers (3 from backend + 1 strategic VIP)`);
                    } catch (error) {
                        console.error('â Failed to load at-risk customers:', error);
                    }
                },

                // NOTE: generateAIRecommendation() REMOVED - aiRecommendation is now ONLY generated by running 4-agent workflow
                // Real AI recommendations are created when backend processes customer through BodhaâDhyanaâNitiâKaruna agents

                // Select At-Risk Customer
                selectAtRiskCustomer(customer) {
                    this.selectedAtRiskCustomer = customer;
                    
                    // Debug: Log customer data to see what we have
                    console.log('ð Selected customer:', customer.name);
                    console.log('ð Customer data:', customer);
                    console.log('ð¤ AI Recommendation:', customer.processedInfo?.intervention?.recommendation || customer.aiRecommendation);
                    console.log('ð¬ Message:', customer.processedInfo?.intervention?.message);
                    
                    // Load intervention message from backend data
                    if (customer.processedInfo?.intervention?.message) {
                        this.atRiskMessage = customer.processedInfo.intervention.message;
                    } else if (customer.status === 'pending') {
                        // Clear message for pending customers
                        this.atRiskMessage = '';
                    }
                    
                    this.atRiskNotes = '';
                    
                    console.log('Selected at-risk customer:', customer);
                },

                // View 4-Agent Journey (Full Details Modal)
                viewAgentJourney(customer) {
                    this.agentJourneyData = {
                        customerName: customer.name,
                        customerId: customer.id,
                        status: customer.status,
                        intervention: customer.processedInfo?.intervention
                    };
                    this.showAgentJourneyModal = true;
                },

                // View Full Details (button click)
                viewFullDetails() {
                    if (this.selectedAtRiskCustomer) {
                        this.viewAgentJourney(this.selectedAtRiskCustomer);
                    }
                },

                // Generate Intervention Message (AI-powered)
                generateInterventionMessage(customer) {
                    const language = customer.language || 'English';
                    const name = customer.name?.split(' ')[0] || 'Customer';
                    const segment = customer.segment || 'valued';
                    
                    // Language-specific greetings
                    const greetings = {
                        'Hindi': `à¤¨à¤®à¤¸à¥à¤¤à¥ ${name}! ð`,
                        'Bengali': `à¦¨à¦®à¦¸à§à¦à¦¾à¦° ${name}! ð`,
                        'Tamil': `à®µà®£à®à¯à®à®®à¯ ${name}! ð`,
                        'Telugu': `à°¨à°®à°¸à±à°à°¾à°°à° ${name}! ð`,
                        'English': `Hello ${name}! ð`
                    };
                    
                    const greeting = greetings[language] || greetings['English'];
                    
                    // Base message template
                    const message = `${greeting}

We hope this message finds you well! We noticed it's been a while since your last visit, and we truly miss having you as part of our community.

As a ${segment.toLowerCase()} customer, you mean a lot to us, and we want to show our appreciation with something special just for you:

â¨ SPECIAL OFFER FOR YOU:
â¢ 15% OFF on your next purchase
â¢ FREE EXPRESS SHIPPING
â¢ Exclusive early access to our Diwali Festival Sale

We've also made significant improvements to our service based on customer feedback, and we'd love for you to experience the difference!

Your satisfaction is our top priority, and we're here to help with anything you need.

Looking forward to serving you again soon!

Warm regards,
Your ProCX Team ð`;

                    return message;
                },

                // Send Intervention
                async sendIntervention() {
                    if (!this.selectedAtRiskCustomer || !this.atRiskMessage.trim()) {
                        this.showToast('error', 'Cannot Send', 'Please ensure a message is entered.');
                        return;
                    }
                    
                    const customerName = this.selectedAtRiskCustomer.name;
                    
                    // Save the message before changing status
                    this.selectedAtRiskCustomer.humanMessage = this.atRiskMessage;
                    this.selectedAtRiskCustomer.humanNotes = this.atRiskNotes;
                    
                    // Change status from 'escalated' to 'sent' (human sent the intervention)
                    this.selectedAtRiskCustomer.status = 'sent';
                    this.selectedAtRiskCustomer.statusText = 'AUTO-SENT';  // Keep consistent with auto-sent
                    this.selectedAtRiskCustomer.statusClass = 'bg-green-500/20 text-green-300';
                    this.selectedAtRiskCustomer.humanInterventionSent = true;
                    this.selectedAtRiskCustomer.interventionSent = true;
                    this.selectedAtRiskCustomer.interventionDate = new Date().toISOString();
                    
                    // Update the processedInfo to mark as sent
                    if (this.selectedAtRiskCustomer.processedInfo) {
                        this.selectedAtRiskCustomer.processedInfo.status = 'sent';
                    }
                    
                    // Show success toast
                    this.showToast('success', 'Intervention Sent!', `Proactive message sent to ${customerName}. Monitoring their response.`);
                    
                    // Add to event log
                    this.addEvent(`Human intervention sent: ${customerName}`, 'success');
                    
                    // Log for demo
                    console.log('ð§ Human intervention sent to:', customerName);
                    console.log('Message:', this.atRiskMessage);
                    console.log('Notes:', this.atRiskNotes);
                    
                    // DON'T clear the message - keep it visible as read-only (status 'sent' will show uneditable view)
                    // The UI will automatically switch to the "sent" view which shows the message in a scrollable div
                },

                // Schedule Intervention (Simple Snooze)
                scheduleIntervention() {
                    if (!this.selectedAtRiskCustomer) return;
                    
                    const customerName = this.selectedAtRiskCustomer.name;
                    
                    // Mark customer as scheduled for review
                    this.selectedAtRiskCustomer.status = 'scheduled';
                    this.selectedAtRiskCustomer.scheduledDate = new Date();
                    this.selectedAtRiskCustomer.reviewIn = '3 days'; // Default review period
                    
                    // Show success toast
                    this.showToast('info', 'Scheduled for Review', 
                        `${customerName} will be reviewed again in 3 days. We'll monitor their activity in the meantime.`);
                    
                    // Add to event log
                    this.addEvent(`Scheduled review: ${customerName} (in 3 days)`, 'info');
                    
                    console.log('ð Scheduled for review:', customerName);
                },

                // View Full Customer Details (Modal)
                async viewFullDetails() {
                    if (!this.selectedAtRiskCustomer) return;
                    
                    const customerId = this.selectedAtRiskCustomer.id;
                    const customerName = this.selectedAtRiskCustomer.name;
                    
                    // Show modal
                    this.showFullDetailsModal = true;
                    this.fullDetailsLoading = true;
                    
                    try {
                        // Fetch full customer details from API
                        const response = await fetch(`/api/customers/${customerId}`);
                        const data = await response.json();
                        
                        // Mock additional data for demo if API doesn't return everything
                        this.fullDetailsData = {
                            ...this.selectedAtRiskCustomer,
                            ...data.customer,
                            
                            // Purchase History (mock data - replace with real API data)
                            purchaseHistory: [
                                { date: 'Oct 12, 2024', amount: 234, items: 'Electronics: Wireless Headphones', status: 'Delivered' },
                                { date: 'Sep 3, 2024', amount: 156, items: 'Fashion: Summer Dress', status: 'Delivered' },
                                { date: 'Aug 15, 2024', amount: 89, items: 'Beauty: Skincare Set', status: 'Returned' },
                                { date: 'Jul 22, 2024', amount: 312, items: 'Electronics: Smart Watch', status: 'Delivered' },
                                { date: 'Jun 10, 2024', amount: 67, items: 'Home: Kitchen Organizer', status: 'Delivered' }
                            ],
                            
                            // Support Tickets (mock data)
                            supportTickets: [
                                { 
                                    id: '4521', 
                                    date: 'Sep 15, 2024', 
                                    issue: 'Shipping Delay', 
                                    resolution: 'Expedited shipping provided for next order',
                                    status: 'RESOLVED',
                                    csat: 3
                                },
                                { 
                                    id: '4102', 
                                    date: 'Aug 20, 2024', 
                                    issue: 'Product Defect - Beauty Item', 
                                    resolution: 'Full refund processed + 10% discount code',
                                    status: 'RESOLVED',
                                    csat: 2
                                },
                                { 
                                    id: '3845', 
                                    date: 'Jul 5, 2024', 
                                    issue: 'Wrong Item Delivered', 
                                    resolution: 'Correct item shipped, returned item pickup arranged',
                                    status: 'RESOLVED',
                                    csat: 4
                                }
                            ],
                            
                            // NPS Trend
                            nps: {
                                current: Math.floor(this.selectedAtRiskCustomer.churnRisk >= 80 ? 3 : this.selectedAtRiskCustomer.churnRisk >= 60 ? 5 : 7),
                                previous: Math.floor(this.selectedAtRiskCustomer.churnRisk >= 80 ? 8 : this.selectedAtRiskCustomer.churnRisk >= 60 ? 7 : 6)
                            }
                        };
                        
                        this.fullDetailsLoading = false;
                        
                        console.log('ð Loaded full details for:', customerName, this.fullDetailsData);
                        
                    } catch (error) {
                        console.error('Failed to load customer details:', error);
                        this.showToast('error', 'Load Failed', 'Could not load customer details. Please try again.');
                        this.fullDetailsLoading = false;
                        this.showFullDetailsModal = false;
                    }
                }
            }
        }
    </script>

    <!-- Toast Container -->
    <div class="toast-container" id="toastContainer"></div>

</body>
</html>