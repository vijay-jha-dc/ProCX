# ğŸ¨ Visual Guide: Multi-Sheet Data Mapping & Step 7

## ğŸ—ºï¸ How We Map Data Across Multiple Sheets

### The Foreign Key: `customer_id`

```
                    CUSTOMER C100109
                           â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                  â”‚                  â”‚
        â†“                  â†“                  â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  CUSTOMERS    â”‚  â”‚    ORDERS     â”‚  â”‚   TICKETS     â”‚
â”‚   (1,000)     â”‚  â”‚   (5,000)     â”‚  â”‚   (2,000)     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ customer_id   â”‚  â”‚ customer_id   â”‚  â”‚ customer_id   â”‚
â”‚ C100109       â”‚  â”‚ C100109       â”‚  â”‚ C100109       â”‚
â”‚ Rajesh Kumar  â”‚  â”‚ ORD001        â”‚  â”‚ TICKET-789    â”‚
â”‚ VIP           â”‚  â”‚ $2,500        â”‚  â”‚ Open          â”‚
â”‚ $45,230 LTV   â”‚  â”‚ 2024-12-01    â”‚  â”‚ High Priority â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
                   â”‚ C100109       â”‚  â”‚ C100109       â”‚
                   â”‚ ORD003        â”‚  â”‚ TICKET-823    â”‚
                   â”‚ $3,400        â”‚  â”‚ Resolved      â”‚
                   â”‚ 2024-12-15    â”‚  â”‚ Medium        â”‚
                   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚ C100109       â”‚
                   â”‚ ORD005        â”‚
                   â”‚ $1,100        â”‚
                   â”‚ 2025-01-05    â”‚
                   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                  â”‚                  â”‚
        â†“                  â†“                  â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   PAYMENTS    â”‚  â”‚  NPS_SURVEY   â”‚  â”‚ CHURN_LABELS  â”‚
â”‚   (4,750)     â”‚  â”‚     (800)     â”‚  â”‚   (1,000)     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ customer_id   â”‚  â”‚ customer_id   â”‚  â”‚ customer_id   â”‚
â”‚ C100109       â”‚  â”‚ C100109       â”‚  â”‚ C100109       â”‚
â”‚ SUCCESS       â”‚  â”‚ Score: 4      â”‚  â”‚ is_churn: 0   â”‚
â”‚ $2,500        â”‚  â”‚ Date: 2025    â”‚  â”‚ risk: 0.68    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚ Feedback: Bad â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚ C100109       â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚ FAILED        â”‚
â”‚ $3,400        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ”„ Complete Data Flow: Raw Data â†’ Final Message

```
STEP 1: LOAD DATA
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
Excel Files                          Pandas DataFrames
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                        â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
AgentMAX_CX_dataset.xlsx
â”œâ”€â”€ customers (1,000)      â”€â”€â”€â”€â”€â”€â”€â”€â†’  self.df
â”œâ”€â”€ orders (5,000)         â”€â”€â”€â”€â”€â”€â”€â”€â†’  self.orders_df
â”œâ”€â”€ support_tickets (2,000)â”€â”€â”€â”€â”€â”€â”€â”€â†’  self.support_tickets_df
â”œâ”€â”€ nps_survey (800)       â”€â”€â”€â”€â”€â”€â”€â”€â†’  self.nps_survey_df
â”œâ”€â”€ payments (4,750)       â”€â”€â”€â”€â”€â”€â”€â”€â†’  self.payments_df
â””â”€â”€ churn_labels (1,000)   â”€â”€â”€â”€â”€â”€â”€â”€â†’  self.churn_labels_df

[Loaded ONCE using singleton pattern]


STEP 2: FETCH CUSTOMER-SPECIFIC DATA
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
For Customer C100109:

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  customer = self.df[customer_id == 'C100109']              â”‚
â”‚  â†“                                                          â”‚
â”‚  Customer Object:                                           â”‚
â”‚    - customer_id: C100109                                   â”‚
â”‚    - name: Rajesh Kumar                                     â”‚
â”‚    - segment: VIP                                           â”‚
â”‚    - lifetime_value: $45,230                                â”‚
â”‚    - loyalty_tier: Platinum                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â†“
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                 â”‚                 â”‚
        â†“                 â†“                 â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ FETCH ORDERS    â”‚ â”‚ FETCH TICKETS   â”‚ â”‚ FETCH PAYMENTS  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Filter:         â”‚ â”‚ Filter:         â”‚ â”‚ Filter:         â”‚
â”‚ orders_df[      â”‚ â”‚ tickets_df[     â”‚ â”‚ payments_df[    â”‚
â”‚  customer_id==  â”‚ â”‚  customer_id==  â”‚ â”‚  customer_id==  â”‚
â”‚  'C100109']     â”‚ â”‚  'C100109']     â”‚ â”‚  'C100109']     â”‚
â”‚                 â”‚ â”‚                 â”‚ â”‚                 â”‚
â”‚ Result:         â”‚ â”‚ Result:         â”‚ â”‚ Result:         â”‚
â”‚ 3 orders        â”‚ â”‚ 2 tickets       â”‚ â”‚ 5 payments      â”‚
â”‚ Total: $7,000   â”‚ â”‚ 1 open          â”‚ â”‚ 1 failed        â”‚
â”‚ Last: 45d ago   â”‚ â”‚ Avg time: 48h   â”‚ â”‚ Success: 80%    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚                 â”‚                 â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â†“
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚ FETCH NPS   â”‚
                    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
                    â”‚ nps_df[     â”‚
                    â”‚  customer_  â”‚
                    â”‚  id=='...'] â”‚
                    â”‚             â”‚
                    â”‚ Result:     â”‚
                    â”‚ Score: 4/10 â”‚
                    â”‚ Detractor   â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


STEP 3: CALCULATE HEALTH SCORE
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
Input: Customer object + fetched data

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  health_score = 0.0                                         â”‚
â”‚                                                             â”‚
â”‚  Factor 1: Segment = VIP           â†’ +15 points            â”‚
â”‚  Factor 2: LTV Percentile = 75%    â†’ +9 points             â”‚
â”‚  Factor 3: Loyalty = Platinum      â†’ +10 points            â”‚
â”‚  Factor 4: Relative Value = 1.2x   â†’ +8 points             â”‚
â”‚  Factor 5: Days Inactive = 45      â†’ +4 points (low!)      â”‚
â”‚  Factor 6: Order Frequency = 0.8/m â†’ +6 points             â”‚
â”‚  Factor 7: Spending Trend = -10%   â†’ +5 points (decline!)  â”‚
â”‚  Factor 8: Support Tickets = 2     â†’ +3 points (issues!)   â”‚
â”‚  Factor 9: NPS Score = 4           â†’ +0 points (bad!)      â”‚
â”‚  Factor 10: Tenure = 2 years       â†’ +3 points             â”‚
â”‚                                                             â”‚
â”‚  Total: 58 / 100                                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


STEP 4: CALCULATE CHURN RISK
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
Input: Health score + churn_labels data

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Base risk from health:                                     â”‚
â”‚    health_score = 58 â†’ base_risk = 42%                      â”‚
â”‚                                                             â”‚
â”‚  Adjustment from churn_labels (ML model):                   â”‚
â”‚    predicted_churn_score = 0.68                             â”‚
â”‚                                                             â”‚
â”‚  Find similar customers who churned:                        â”‚
â”‚    - 3 VIP customers with health 55-60 â†’ 2 churned         â”‚
â”‚    - Churn rate in this group: 67%                          â”‚
â”‚                                                             â”‚
â”‚  Final churn_risk = (base_risk + predicted + similar) / 3   â”‚
â”‚                   = (42% + 68% + 67%) / 3                   â”‚
â”‚                   = 59% â†’ Adjusted to 68% (model weight)    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


STEP 5: FILTER AT-RISK
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
Conditions:
  churn_risk > 60% âœ“ (68%)
  lifetime_value > $2,000 âœ“ ($45,230)
  segment in [VIP, Loyal] âœ“ (VIP)

â†’ Customer C100109 is AT RISK!


STEP 6: SORT BY PRIORITY
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
Priority Score = churn_risk Ã— lifetime_value

C100109: 0.68 Ã— $45,230 = $30,756  â† Highest priority!
C100141: 0.71 Ã— $12,450 = $8,840
C100302: 0.65 Ã— $8,900  = $5,785

â†’ C100109 gets processed first


STEP 7: GENERATE DESCRIPTION (THIS IS THE KEY STEP!)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
Input: Customer object + Alert dict

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  alert = {                                                  â”‚
â”‚    'customer': <Customer C100109>,                          â”‚
â”‚    'health_score': 0.58,                                    â”‚
â”‚    'churn_risk': 0.68,                                      â”‚
â”‚    'reasons': [                                             â”‚
â”‚      'Low health score',                                    â”‚
â”‚      'High-value segment at risk',                          â”‚
â”‚      'Below-average in cohort'                              â”‚
â”‚    ],                                                       â”‚
â”‚    'recommended_action': 'immediate_personal_outreach'      â”‚
â”‚  }                                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â†“
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚ GENERATION LOGIC      â”‚
              â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
              â”‚ 1. Extract scores     â”‚
              â”‚ 2. Categorize health  â”‚
              â”‚ 3. Format description â”‚
              â”‚ 4. Create event       â”‚
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  GENERATED DESCRIPTION:                                     â”‚
â”‚                                                             â”‚
â”‚  VIP customer at high risk (LTV: $45,230.50)                â”‚
â”‚  â€¢ Health Score: 58/100 (Warning)                           â”‚
â”‚  â€¢ Churn Risk: 68%                                          â”‚
â”‚  â€¢ Risk Factors: Low health score, High-value segment at   â”‚
â”‚    risk, Below-average in cohort                            â”‚
â”‚  â€¢ Recommended Action: Immediate Personal Outreach          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

This description is:
  âœ“ Technical (for AI agents)
  âœ“ Data-driven (all numbers from analysis)
  âœ“ Actionable (includes recommendation)


STEP 8: AGENT PIPELINE
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
Input: CustomerEvent with description

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  CustomerEvent:                                             â”‚
â”‚    event_id: PROACTIVE_C100109_1234567890                   â”‚
â”‚    customer: <Customer C100109>                             â”‚
â”‚    description: "VIP customer at high risk..."              â”‚
â”‚    metadata: {health_score, churn_risk, reasons}            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â†“
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â†“                 â†“                 â†“
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚ Context  â”‚  â†’   â”‚ Pattern  â”‚  â†’   â”‚ Decision â”‚
  â”‚  Agent   â”‚      â”‚  Agent   â”‚      â”‚  Agent   â”‚
  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤      â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤      â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
  â”‚ Analyzes â”‚      â”‚ Finds    â”‚      â”‚ Chooses  â”‚
  â”‚ customer â”‚      â”‚ similar  â”‚      â”‚ channel  â”‚
  â”‚ history  â”‚      â”‚ cases    â”‚      â”‚ & timing â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚                 â”‚                 â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â†“
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚ Empathy  â”‚
                    â”‚  Agent   â”‚
                    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
                    â”‚ Generatesâ”‚
                    â”‚ response â”‚
                    â”‚ (GPT-4)  â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


STEP 9: FINAL MESSAGE (DIFFERENT FROM STEP 7!)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
Input: Agent decisions + customer context

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  EMPATHY AGENT OUTPUT:                                      â”‚
â”‚                                                             â”‚
â”‚  Subject: We Miss You, Rajesh!                              â”‚
â”‚                                                             â”‚
â”‚  Dear Rajesh,                                               â”‚
â”‚                                                             â”‚
â”‚  As one of our most valued VIP members, we noticed you      â”‚
â”‚  haven't placed an order in the past 45 days. We hope       â”‚
â”‚  everything is going well!                                  â”‚
â”‚                                                             â”‚
â”‚  We genuinely appreciate your loyalty over the past 2       â”‚
â”‚  years and would love to continue serving you. To show      â”‚
â”‚  our appreciation, we'd like to offer you:                  â”‚
â”‚                                                             â”‚
â”‚  â€¢ 25% OFF your next order                                  â”‚
â”‚  â€¢ Free express shipping                                    â”‚
â”‚  â€¢ Priority customer support                                â”‚
â”‚  â€¢ Personal account manager                                 â”‚
â”‚                                                             â”‚
â”‚  Your feedback matters to us. If there's anything we        â”‚
â”‚  can improve, please let us know. We're here to help!       â”‚
â”‚                                                             â”‚
â”‚  Best regards,                                              â”‚
â”‚  The Customer Experience Team                               â”‚
â”‚                                                             â”‚
â”‚  [Empathy Score: 9.5/10]                                    â”‚
â”‚  [Channel: Email + SMS]                                     â”‚
â”‚  [Timing: Send within 24 hours]                             â”‚
â”‚  [Escalation: Assign account manager]                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

This message is:
  âœ“ Empathetic (warm, understanding tone)
  âœ“ Personalized (uses name, history, offers)
  âœ“ Actionable (clear offers and CTA)
```

---

## ğŸ“Š Key Differences: Step 7 vs Step 9

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    STEP 7 DESCRIPTION                        â”‚
â”‚              (Problem Summary for AI Agents)                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  VIP customer at high risk (LTV: $45,230.50)                 â”‚
â”‚  â€¢ Health Score: 58/100 (Warning)                            â”‚
â”‚  â€¢ Churn Risk: 68%                                           â”‚
â”‚  â€¢ Risk Factors: Low health score, High-value segment at     â”‚
â”‚    risk, Below-average in cohort                             â”‚
â”‚  â€¢ Recommended Action: Immediate Personal Outreach           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Audience: AI Agents                                         â”‚
â”‚  Tone: Technical/Analytical                                  â”‚
â”‚  Generated by: ProCX System Logic                            â”‚
â”‚  Purpose: Context for decision-making                        â”‚
â”‚  Length: 5 lines                                             â”‚
â”‚  Content: Scores, risks, facts                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â†“
                     [Agent Pipeline]
                            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    STEP 9 FINAL MESSAGE                      â”‚
â”‚               (Customer Outreach Response)                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Dear Rajesh,                                                â”‚
â”‚                                                              â”‚
â”‚  As one of our most valued VIP members, we noticed you       â”‚
â”‚  haven't placed an order in the past 45 days...              â”‚
â”‚                                                              â”‚
â”‚  We'd like to offer you:                                     â”‚
â”‚  â€¢ 25% OFF your next order                                   â”‚
â”‚  â€¢ Free express shipping                                     â”‚
â”‚  â€¢ Personal account manager                                  â”‚
â”‚                                                              â”‚
â”‚  Your feedback matters to us...                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Audience: Customer (Rajesh)                                 â”‚
â”‚  Tone: Empathetic/Warm                                       â”‚
â”‚  Generated by: GPT-4 Empathy Agent                           â”‚
â”‚  Purpose: Retention & engagement                             â”‚
â”‚  Length: 15+ lines                                           â”‚
â”‚  Content: Offers, support, solutions                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ¯ Quick Reference: Where Things Happen

| What                              | Where                      | Input               | Output             |
| --------------------------------- | -------------------------- | ------------------- | ------------------ |
| **Load data**                     | `data_analytics.py:49`     | Excel file          | DataFrames         |
| **Filter by customer**            | `data_analytics.py:714`    | `customer_id`       | Filtered rows      |
| **Calculate health**              | `proactive_monitor.py:16`  | Customer + data     | Score 0-1          |
| **Calculate churn**               | `proactive_monitor.py:144` | Health + labels     | Risk 0-1           |
| **Detect at-risk**                | `proactive_monitor.py:220` | All customers       | Alert list         |
| **Sort priority**                 | `proactive_monitor.py:334` | Alert list          | Sorted alerts      |
| **Generate description (Step 7)** | `main.py:204`              | Customer + alert    | Description string |
| **Agent pipeline**                | `workflows/cx_workflow.py` | CustomerEvent       | Agent decisions    |
| **Generate message (Step 9)**     | `agents/empathy_agent.py`  | Context + decisions | Final message      |

---

## ğŸ’¡ The Big Picture

```
Excel Data â†’ Load â†’ Filter â†’ Analyze â†’ [STEP 7: Describe] â†’ Agents â†’ [STEP 9: Respond]
  (Raw)    (Pandas) (by ID)  (scores)   (Technical)     (GPT-4)    (Empathetic)
```

**Step 7 = Problem definition (what's wrong)**
**Step 9 = Solution delivery (how to fix it)**

They're completely different outputs serving different purposes!
